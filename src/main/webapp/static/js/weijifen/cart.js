define("wap/components/new_cart/goods_list/models/goods_item",["require","zenjs/util/args"],function(t){var e=t("zenjs/util/args"),i=Backbone.Model.extend({initialize:function(){this.id=this.get("sku_id")+"-"+this.get("goods_id")},url:function(){return e.add(this.urlRoot,{kdt_id:this.get("kdt_id"),sku_id:this.get("sku_id"),goods_id:this.get("goods_id"),store_id:this.get("store_id")||0})},defaults:{checked:!1},parse:function(t,e){var i=this.get("limitNum")||0,n=parseInt(t.stock_num,10);return t.limitNum=i>0?Math.min(i,n):n,this.editing=this.editing||t.isEditing,delete t.isEditing,t},getGoodsJson:function(){var t=this.get("pay_price")||0,e=this.get("code")||"",i=this.get("num");return null==i?null:{goods_id:this.get("goods_id"),sku_id:this.get("sku_id"),price:t,num:i,id:this.get("sku_id"),sku_code:e,activity_alias:this.get("activity_alias"),item_message:this.get("messages")}},isCheckable:function(){if(this.editing)return!0;var t=this.get("limitNum");if(t>=0){var e=parseInt(this.get("num"),10);return t>=e}return this.disabled?!1:!0}});return i}),define("wap/components/new_cart/goods_list/collections/goods_list",["require","../models/goods_item"],function(t){var e=t("../models/goods_item");return Backbone.Collection.extend({initialize:function(t,i){this.model=(i.GoodsModel||e).extend({urlRoot:i.modelUrlRoot}),this.url=i.modelUrlRoot,this.goodsJson=i.goodsJson||{},this.kdt_id=i.kdt_id},parse:function(t){var e=this,i=$.extend(!0,[],t.data);return _.each(i,function(t){t.isEditing=e.isEditing,t.sku&&(t.sku=JSON.parse(t.sku))}),i},getTotalPrice:function(){var t=0;return this.each(function(e){var i=e.get("pay_price")||0;e.get("checked")&&(t+=i*e.get("num"))},this),t/100},isAllChecked:function(t){var e=this.find(function(e){return!e.get(t)},this);return void 0===e},getBrief:function(t){var e,i,n=0,o=0,s=0,r=!1,a=!0,l=!1;return this.each(function(c){var h=c.get("pay_price")||0;c.get(t)&&(("checked"==t||c.get("checked"))&&(n+=h*c.get("num"),s+=parseInt(c.get("num"),10),"boolean"!=typeof e||e===c.onlyPayOnDeliver||r||(r=!0),c.onlyPayOnDeliver||(a=!1),"undefined"!=typeof i&&i!=c.get("kdt_id")&&(l=!0),e=c.onlyPayOnDeliver,i=c.get("kdt_id")),o++)},this),a&&l&&(r=!0),{totalPrice:n,flagged:o,total:this.length,totalNum:s,isConflict:r}},getGoodsListJson:function(t){var e,i={},n=[],o=!1,s=!1,r=null,a=!1,l=!0,c=_.filter(this.models,function(t){return t.get("checked")}),h=c.length;if(0==h)return{json:null};if(t){for(var d=1;h>d&&c[d-1].shop_kdt_id==c[d].shop_kdt_id;d++);d>=h?(s=!1,r=c[0].shop_kdt_id):s=!0}else r=this.kdt_id||c[0].shop_kdt_id;if(s){_.each(c,function(t){if(t.get("checked")){"boolean"!=typeof e||e===t.onlyPayOnDeliver||a||(a=!0),t.onlyPayOnDeliver||(l=!1),e=t.onlyPayOnDeliver;var n=t.get("goods_id");t.getGoodsJson()?(i[n]||(i[n]=[]),i[n].push(t)):o=!0}});for(var u in i){var p={id:u,sku_list:[],kdt_id:i[u][0].shop_kdt_id};i[u].forEach(function(t){p.sku_list.push(t.getGoodsJson())}),n.push(p)}}else _.each(c,function(t){if(t.get("checked")){var e=t.getGoodsJson();e?n.push(e):o=!0}});return l&&s&&(a=!0),o?{json:null,errorMsg:"数量不对哦"}:n.length>0?{json:_.extend({cart:n,isMultiShopChecked:s,kdt_id:r,isConflict:a},this.goodsJson)}:{json:null}},updateAllCheck:function(t,e){this.each(function(i){i.isCheckable()&&i.set(e,t)},this)}})}),define("text!wap/components/new_cart/goods_list/templates/goodsItem.html",[],function(){return'<%\nif (data) {\n    var gooodsLink = isEditing ? \'javascript:;\' : getGoodsLink();\n%>\n    <div class="check-container\n        <% if (notShowCheckBox && !isEditing) { %>\n        hide\n        <% } %>\n    ">\n        <span class="check\n        <% if (!isEditing && data.checked) { %>\n         checked\n        <% } %>"></span>\n    </div>\n    <div class="name-card clearfix">\n        <a href="<%= gooodsLink %>" class="thumb js-goods-link"><img src="<%= getCdnImageUrl(data.attachment_url, \'!200x200.jpg\') %>"></a>\n        <div class="detail">\n            <a class="js-goods-link" href="<%= gooodsLink %>">\n                <h3 class="title js-ellipsis"><i><%= data.title %></i></h3>\n            </a>\n            <p class="sku ellipsis">\n                <%= _.map(data.sku && JSON.parse(data.sku) || [], function(item){\n                        return item.v;\n                    }).join(\'，\') %>\n            </p>\n            <% if (!notShowNum) { %>\n            <div class="num">\n                &times;<span class="num-txt"><%= data.num %></span>\n            </div>\n            <% } %>\n            <% if (!notShowPrice) { %>\n            <div class="price c-orange">￥<span><%= (data.pay_price/100).toFixed(2) %></span></div>\n            <% } %>\n        </div>\n        <div class="error-box"><%= data.error_msg %></div>\n    </div>\n    <div class="delete-btn"> <span>删除</span> </div>\n<% } %>\n'}),function(t){function e(e){return!e||void 0!==e.allowPageScroll||void 0===e.swipe&&void 0===e.swipeStatus||(e.allowPageScroll=c),void 0!==e.click&&void 0===e.tap&&(e.tap=e.click),e||(e={}),e=t.extend({},t.fn.swipe.defaults,e),this.each(function(){var n=t(this),o=n.data(E);o||(o=new i(this,e),n.data(E,o))})}function i(e,i){function T(e){if(!(ct()||t(e.target).closest(i.excludedElements,Ht).length>0)){var n,o=e.originalEvent?e.originalEvent:e,s=x?o.touches[0]:o;return Rt=b,x?qt=o.touches.length:e.preventDefault(),Dt=0,Ot=null,Gt=null,Nt=0,It=0,Vt=0,$t=1,Mt=0,Kt=mt(),Ut=vt(),at(),!x||qt===i.fingers||i.fingers===w||U()?(dt(0,s),Wt=St(),2==qt&&(dt(1,o.touches[1]),It=Vt=bt(Kt[0].start,Kt[1].start)),(i.swipeStatus||i.pinchStatus)&&(n=D(o,Rt))):n=!1,n===!1?(Rt=C,D(o,Rt),n):(i.hold&&(te=setTimeout(t.proxy(function(){Ht.trigger("hold",[o.target]),i.hold&&(n=i.hold.call(Ht,o,o.target))},this),i.longTapThreshold)),ht(!0),null)}}function L(t){var e=t.originalEvent?t.originalEvent:t;if(Rt!==k&&Rt!==C&&!lt()){var n,o=x?e.touches[0]:e,s=ut(o);if(Jt=St(),x&&(qt=e.touches.length),i.hold&&clearTimeout(te),Rt=y,2==qt&&(0==It?(dt(1,e.touches[1]),It=Vt=bt(Kt[0].start,Kt[1].start)):(ut(e.touches[1]),Vt=bt(Kt[0].end,Kt[1].end),Gt=kt(Kt[0].end,Kt[1].end)),$t=yt(It,Vt),Mt=Math.abs(It-Vt)),qt===i.fingers||i.fingers===w||!x||U()){if(Ot=jt(s.start,s.end),M(t,Ot),Dt=Ct(s.start,s.end),Nt=_t(),ft(Ot,Dt),(i.swipeStatus||i.pinchStatus)&&(n=D(e,Rt)),i.triggerOnTouchEnd||i.triggerOnTouchLeave){var r=!0;if(i.triggerOnTouchLeave){var a=Et(this);r=Tt(s.end,a)}!i.triggerOnTouchEnd&&r?Rt=A(y):i.triggerOnTouchLeave&&!r&&(Rt=A(k)),(Rt==C||Rt==k)&&D(e,Rt)}}else Rt=C,D(e,Rt);n===!1&&(Rt=C,D(e,Rt))}}function z(t){var e=t.originalEvent?t.originalEvent:t;return x&&e.touches.length>0?(rt(),!0):(lt()&&(qt=Yt),Jt=St(),Nt=_t(),I()||!N()?(Rt=C,D(e,Rt)):i.triggerOnTouchEnd||0==i.triggerOnTouchEnd&&Rt===y?(t.preventDefault(),Rt=k,D(e,Rt)):!i.triggerOnTouchEnd&&X()?(Rt=k,O(e,Rt,p)):Rt===y&&(Rt=C,D(e,Rt)),ht(!1),null)}function F(){qt=0,Jt=0,Wt=0,It=0,Vt=0,$t=1,at(),ht(!1)}function P(t){var e=t.originalEvent?t.originalEvent:t;i.triggerOnTouchLeave&&(Rt=A(k),D(e,Rt))}function B(){Ht.unbind(zt,T),Ht.unbind(At,F),Ht.unbind(Ft,L),Ht.unbind(Pt,z),Bt&&Ht.unbind(Bt,P),ht(!1)}function A(t){var e=t,n=$(),o=N(),s=I();return!n||s?e=C:!o||t!=y||i.triggerOnTouchEnd&&!i.triggerOnTouchLeave?!o&&t==k&&i.triggerOnTouchLeave&&(e=C):e=k,e}function D(t,e){var i=void 0;return K()||q()?i=O(t,e,d):(H()||U())&&i!==!1&&(i=O(t,e,u)),ot()&&i!==!1?i=O(t,e,m):st()&&i!==!1?i=O(t,e,f):nt()&&i!==!1&&(i=O(t,e,p)),e===C&&F(t),e===k&&(x?0==t.touches.length&&F(t):F(t)),i}function O(e,c,h){var g=void 0;if(h==d){if(Ht.trigger("swipeStatus",[c,Ot||null,Dt||0,Nt||0,qt,Kt]),i.swipeStatus&&(g=i.swipeStatus.call(Ht,e,c,Ot||null,Dt||0,Nt||0,qt,Kt),g===!1))return!1;if(c==k&&R()){if(Ht.trigger("swipe",[Ot,Dt,Nt,qt,Kt]),i.swipe&&(g=i.swipe.call(Ht,e,Ot,Dt,Nt,qt,Kt),g===!1))return!1;switch(Ot){case n:Ht.trigger("swipeLeft",[Ot,Dt,Nt,qt,Kt]),i.swipeLeft&&(g=i.swipeLeft.call(Ht,e,Ot,Dt,Nt,qt,Kt));break;case o:Ht.trigger("swipeRight",[Ot,Dt,Nt,qt,Kt]),i.swipeRight&&(g=i.swipeRight.call(Ht,e,Ot,Dt,Nt,qt,Kt));break;case s:Ht.trigger("swipeUp",[Ot,Dt,Nt,qt,Kt]),i.swipeUp&&(g=i.swipeUp.call(Ht,e,Ot,Dt,Nt,qt,Kt));break;case r:Ht.trigger("swipeDown",[Ot,Dt,Nt,qt,Kt]),i.swipeDown&&(g=i.swipeDown.call(Ht,e,Ot,Dt,Nt,qt,Kt))}}}if(h==u){if(Ht.trigger("pinchStatus",[c,Gt||null,Mt||0,Nt||0,qt,$t,Kt]),i.pinchStatus&&(g=i.pinchStatus.call(Ht,e,c,Gt||null,Mt||0,Nt||0,qt,$t,Kt),g===!1))return!1;if(c==k&&G())switch(Gt){case a:Ht.trigger("pinchIn",[Gt||null,Mt||0,Nt||0,qt,$t,Kt]),i.pinchIn&&(g=i.pinchIn.call(Ht,e,Gt||null,Mt||0,Nt||0,qt,$t,Kt));break;case l:Ht.trigger("pinchOut",[Gt||null,Mt||0,Nt||0,qt,$t,Kt]),i.pinchOut&&(g=i.pinchOut.call(Ht,e,Gt||null,Mt||0,Nt||0,qt,$t,Kt))}}return h==p?(c===C||c===k)&&(clearTimeout(Zt),clearTimeout(te),Y()&&!tt()?(Qt=St(),Zt=setTimeout(t.proxy(function(){Qt=null,Ht.trigger("tap",[e.target]),i.tap&&(g=i.tap.call(Ht,e,e.target))},this),i.doubleTapThreshold)):(Qt=null,Ht.trigger("tap",[e.target]),i.tap&&(g=i.tap.call(Ht,e,e.target)))):h==m?(c===C||c===k)&&(clearTimeout(Zt),Qt=null,Ht.trigger("doubletap",[e.target]),i.doubleTap&&(g=i.doubleTap.call(Ht,e,e.target))):h==f&&(c===C||c===k)&&(clearTimeout(Zt),Qt=null,Ht.trigger("longtap",[e.target]),i.longTap&&(g=i.longTap.call(Ht,e,e.target))),g}function N(){var t=!0;return null!==i.threshold&&(t=Dt>=i.threshold),t}function I(){var t=!1;return null!==i.cancelThreshold&&null!==Ot&&(t=gt(Ot)-Dt>=i.cancelThreshold),t}function V(){return null!==i.pinchThreshold?Mt>=i.pinchThreshold:!0}function $(){var t;return t=i.maxTimeThreshold&&Nt>=i.maxTimeThreshold?!1:!0}function M(t,e){if(i.allowPageScroll===c||U())t.preventDefault();else{var a=i.allowPageScroll===h;switch(e){case n:(i.swipeLeft&&a||!a&&i.allowPageScroll!=g)&&t.preventDefault();break;case o:(i.swipeRight&&a||!a&&i.allowPageScroll!=g)&&t.preventDefault();break;case s:(i.swipeUp&&a||!a&&i.allowPageScroll!=v)&&t.preventDefault();break;case r:(i.swipeDown&&a||!a&&i.allowPageScroll!=v)&&t.preventDefault()}}}function G(){var t=W(),e=J(),i=V();return t&&e&&i}function U(){return!!(i.pinchStatus||i.pinchIn||i.pinchOut)}function H(){return!(!G()||!U())}function R(){var t=$(),e=N(),i=W(),n=J(),o=I(),s=!o&&n&&i&&e&&t;return s}function q(){return!!(i.swipe||i.swipeStatus||i.swipeLeft||i.swipeRight||i.swipeUp||i.swipeDown)}function K(){return!(!R()||!q())}function W(){return qt===i.fingers||i.fingers===w||!x}function J(){return 0!==Kt[0].end.x}function X(){return!!i.tap}function Y(){return!!i.doubleTap}function Q(){return!!i.longTap}function Z(){if(null==Qt)return!1;var t=St();return Y()&&t-Qt<=i.doubleTapThreshold}function tt(){return Z()}function et(){return(1===qt||!x)&&(isNaN(Dt)||Dt<i.threshold)}function it(){return Nt>i.longTapThreshold&&_>Dt}function nt(){return!(!et()||!X())}function ot(){return!(!Z()||!Y())}function st(){return!(!it()||!Q())}function rt(){Xt=St(),Yt=event.touches.length+1}function at(){Xt=0,Yt=0}function lt(){var t=!1;if(Xt){var e=St()-Xt;e<=i.fingerReleaseThreshold&&(t=!0)}return t}function ct(){return!(Ht.data(E+"_intouch")!==!0)}function ht(t){t===!0?(Ht.bind(Ft,L),Ht.bind(Pt,z),Bt&&Ht.bind(Bt,P)):(Ht.unbind(Ft,L,!1),Ht.unbind(Pt,z,!1),Bt&&Ht.unbind(Bt,P,!1)),Ht.data(E+"_intouch",t===!0)}function dt(t,e){var i=void 0!==e.identifier?e.identifier:0;return Kt[t].identifier=i,Kt[t].start.x=Kt[t].end.x=e.pageX||e.clientX,Kt[t].start.y=Kt[t].end.y=e.pageY||e.clientY,Kt[t]}function ut(t){var e=void 0!==t.identifier?t.identifier:0,i=pt(e);return i.end.x=t.pageX||t.clientX,i.end.y=t.pageY||t.clientY,i}function pt(t){for(var e=0;e<Kt.length;e++)if(Kt[e].identifier==t)return Kt[e]}function mt(){for(var t=[],e=0;5>=e;e++)t.push({start:{x:0,y:0},end:{x:0,y:0},identifier:0});return t}function ft(t,e){e=Math.max(e,gt(t)),Ut[t].distance=e}function gt(t){return Ut[t]?Ut[t].distance:void 0}function vt(){var t={};return t[n]=wt(n),t[o]=wt(o),t[s]=wt(s),t[r]=wt(r),t}function wt(t){return{direction:t,distance:0}}function _t(){return Jt-Wt}function bt(t,e){var i=Math.abs(t.x-e.x),n=Math.abs(t.y-e.y);return Math.round(Math.sqrt(i*i+n*n))}function yt(t,e){var i=e/t*1;return i.toFixed(2)}function kt(){return 1>$t?l:a}function Ct(t,e){return Math.round(Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)))}function xt(t,e){var i=t.x-e.x,n=e.y-t.y,o=Math.atan2(n,i),s=Math.round(180*o/Math.PI);return 0>s&&(s=360-Math.abs(s)),s}function jt(t,e){var i=xt(t,e);return 45>=i&&i>=0?n:360>=i&&i>=315?n:i>=135&&225>=i?o:i>45&&135>i?r:s}function St(){var t=new Date;return t.getTime()}function Et(e){e=t(e);var i=e.offset(),n={left:i.left,right:i.left+e.outerWidth(),top:i.top,bottom:i.top+e.outerHeight()};return n}function Tt(t,e){return t.x>e.left&&t.x<e.right&&t.y>e.top&&t.y<e.bottom}var Lt=x||S||!i.fallbackToMouseEvents,zt=Lt?S?j?"MSPointerDown":"pointerdown":"touchstart":"mousedown",Ft=Lt?S?j?"MSPointerMove":"pointermove":"touchmove":"mousemove",Pt=Lt?S?j?"MSPointerUp":"pointerup":"touchend":"mouseup",Bt=Lt?null:"mouseleave",At=S?j?"MSPointerCancel":"pointercancel":"touchcancel",Dt=0,Ot=null,Nt=0,It=0,Vt=0,$t=1,Mt=0,Gt=0,Ut=null,Ht=t(e),Rt="start",qt=0,Kt=null,Wt=0,Jt=0,Xt=0,Yt=0,Qt=0,Zt=null,te=null;try{Ht.bind(zt,T),Ht.bind(At,F)}catch(ee){t.error("events not supported "+zt+","+At+" on jQuery.swipe")}this.enable=function(){return Ht.bind(zt,T),Ht.bind(At,F),Ht},this.disable=function(){return B(),Ht},this.destroy=function(){return B(),Ht.data(E,null),Ht},this.option=function(e,n){if(void 0!==i[e]){if(void 0===n)return i[e];i[e]=n}else t.error("Option "+e+" does not exist on jQuery.swipe.options");return null}}var n="left",o="right",s="up",r="down",a="in",l="out",c="none",h="auto",d="swipe",u="pinch",p="tap",m="doubletap",f="longtap",g="horizontal",v="vertical",w="all",_=10,b="start",y="move",k="end",C="cancel",x="ontouchstart"in window,j=window.navigator.msPointerEnabled&&!window.navigator.pointerEnabled,S=window.navigator.pointerEnabled||window.navigator.msPointerEnabled,E="TouchSwipe",T={fingers:1,threshold:75,cancelThreshold:null,pinchThreshold:20,maxTimeThreshold:null,fingerReleaseThreshold:250,longTapThreshold:500,doubleTapThreshold:200,swipe:null,swipeLeft:null,swipeRight:null,swipeUp:null,swipeDown:null,swipeStatus:null,pinchIn:null,pinchOut:null,pinchStatus:null,click:null,tap:null,doubleTap:null,longTap:null,hold:null,triggerOnTouchEnd:!0,triggerOnTouchLeave:!1,allowPageScroll:"auto",fallbackToMouseEvents:!0,excludedElements:"label, button, input, select, textarea, a, .noSwipe"};t.fn.swipe=function(i){var n=t(this),o=n.data(E);if(o&&"string"==typeof i){if(o[i])return o[i].apply(this,Array.prototype.slice.call(arguments,1));t.error("Method "+i+" does not exist on jQuery.swipe")}else if(!(o||"object"!=typeof i&&i))return e.apply(this,arguments);return n},t.fn.swipe.defaults=T,t.fn.swipe.phases={PHASE_START:b,PHASE_MOVE:y,PHASE_END:k,PHASE_CANCEL:C},t.fn.swipe.directions={LEFT:n,RIGHT:o,UP:s,DOWN:r,IN:a,OUT:l},t.fn.swipe.pageScroll={NONE:c,HORIZONTAL:g,VERTICAL:v,AUTO:h},t.fn.swipe.fingers={ONE:1,TWO:2,THREE:3,ALL:w}}($),define("vendor/jquery_touchSwipe",function(){}),define("zenjs/backbone/quantity",["require","backbone"],function(t){var e=t("backbone"),i=function(){},n=e.View.extend({template:_.template('<div class="quantity">            <button class="minus" type="button" <% if (data.readonly){ %> disabled <% } %> ></button>            <input type="text" class="txt" value="<%= data.num %>" <% if (data.readonly){ %> readonly <% } %>/>            <button class="plus" type="button" <% if (data.readonly){ %> disabled <% } %>></button>            <div class="response-area response-area-minus"></div>            <div class="response-area response-area-plus"></div>        </div>'),initialize:function(){var t=function(t,e,i){var n;return i>e?(n=e,0!==e&&(this.disabled=!0)):n=i>t?i:t>e?e:t,n};return function(e){this.onNumChange=e.onNumChange||i,this.onOverLimit=e.onOverLimit||i,this.limitNum=parseInt(e.limitNum),this.minimalNum=parseInt(e.minimalNum),this.minimalNum=0==this.minimalNum?0:this.minimalNum||1,this.onBelowLeast=e.onBelowLeast||i,this.disabled=e.disabled,this.num=t.call(this,e.num,this.limitNum,this.minimalNum),this.readonly=e.readonly,this.num!=e.num&&this.onNumChange(this.num)}}(),events:{"click .response-area-minus":"onSubClicked","click .response-area-plus":"onAddClicked","blur .txt":"onTxtBlur"},onSubClicked:function(t){this.changeNum(this.num-1)},onAddClicked:function(){this.changeNum(this.num+1)},onTxtBlur:function(t){var e=t.target.value;this.changeNum(isNaN(e)?0:e)},changeNum:function(t){this.readonly||this.disabled||(t>this.limitNum&&(this.onOverLimit(t,this.limitNum),t=this.limitNum),t<this.minimalNum&&(this.onBelowLeast(t,this.minimalNum),t=this.minimalNum),this.updateBtnStatus(t),this.updateNum(t))},updateBtnStatus:function(){var t=function(t){t.addClass("disabled"),t.attr("disabled","true")},e=function(t){t.removeClass("disabled"),t.removeAttr("disabled")};return function(i){return this.readonly?(t(this.nMinus),void t(this.nPlus)):(i>this.minimalNum?e(this.nMinus):t(this.nMinus),void(this.limitNum>0&&i>=this.limitNum?t(this.nPlus):e(this.nPlus)))}}(),updateNum:function(t){this.disabled||(this.num=+t,this.$("input").val(this.num),this.onNumChange(this.num))},refreshNum:function(){var t=parseInt(this.$("input").val());this.num!==t&&(t>0?this.limitNum>0&&t>this.limitNum?this.num=this.limitNum:this.num=t:(this.num=this.minimalNum,this.updateNum(this.num)),this.changeNum(this.num))},setLimitNum:function(t){this.disabled||1>t||(this.limitNum=+t,this.limitNum<this.num&&this.changeNum(this.limitNum))},setMinimalNum:function(t){this.disabled||1>t||(this.minimalNum=+t,this.num<this.minimalNum&&this.changeNum(this.minimalNum))},validateNum:function(t){var e=parseInt(this.$("input").val());return this.$("input").val(e),e>this.limitNum||0===this.limitNum?(this.onOverLimit(e,this.limitNum),!1):e<this.minimalNum?(this.onBelowLeast(e,this.minimalNum),!1):!0},getNum:function(){return this.validateNum()?(this.refreshNum(),this.num):null},render:function(){return this.$el.html(this.template({data:{num:this.num,readonly:this.readonly}})),this.nMinus=this.$(".minus"),this.nPlus=this.$(".plus"),this.updateBtnStatus(this.num),this}});return n}),window.Utils=window.Utils||{},$.extend(window.Utils,{getCdnImageUrl:function(t,e){if(!t)return window._global.url.cdn_static+"/image/wap/no_pic.png";if(e=t.match(/.+\!\d+x\d+.+/)?"":e&&e.length>0?e:"!100x100.jpg",t.match(/^(https?:)?\/\//i)){for(var i=[/^(https?:)?\/\/imgqn.koudaitong.com/,/^(https?:)?\/\/kdt-img.koudaitong.com/,/^(https?:)?\/\/img.yzcdn.cn/,/^(https?:)?\/\/dn-kdt-img.qbox.me/],n=0;n<i.length;n++)t=t.replace(i[n],window._global.url.imgqn);return t+e}return window._global.url.imgqn+"/"+t+e}}),define("wap/components/util/kdt",function(){}),define("wap/components/new_cart/goods_list/views/goods_item",["require","text!../templates/goodsItem.html","vendor/jquery_touchSwipe","zenjs/backbone/quantity","wap/components/util/kdt","zenjs/util/str","bower_components/youzanjsbridge/api","zenjs/util/args"],function(t){var e=t("text!../templates/goodsItem.html"),i=(t("vendor/jquery_touchSwipe"),t("zenjs/backbone/quantity")),n=(t("wap/components/util/kdt"),t("zenjs/util/str")),o=t("bower_components/youzanjsbridge/api"),s=t("zenjs/util/args"),r=function(){};return Backbone.View.extend({tagName:"li",className:"block-item block-item-cart",initialize:function(t){this.index=t.index,this.listenTo(this.model,"change",this.onChange),this.listenTo(this,"edit:start",this.onEditStart),this.listenTo(this,"edit:finish",this.onEditFinish),this.listenTo(this,"delete:flagged",this.onDeleteFlagged),this.listenTo(this,"remove:flagged",this.onRemoveFlagged),this.listenTo(this,"update:num",this.doUpdateNum),this.template=_.template(t.goodsItemTpl||e),this.beforeItemDelete=t.beforeItemDelete,this.onOverLimit=t.onOverLimit||r,this.onDeleteFinish=t.onDeleteFinish||r,this.notShowCheckBox=t.notShowCheckBox,this.notShowNum=t.notShowNum,this.notShowPrice=t.notShowPrice,this.goodsLink=t.goodsLink||_global.url.wap+"/showcase/goods",this.disableCode={11011:"商品已售罄",11012:"暂时不能购买",11013:"该商品不存在",11014:"该规格已售罄",11020:"该规格已下架",10404:"暂时不能购买"},this.noSwip||this.$el.swipe({triggerOnTouchEnd:!1,swipeStatus:this.swipeStatus(),allowPageScroll:"vertical"}),this.model.shop_kdt_id=t.shop_kdt_id,this.model.onlyPayOnDeliver=t.onlyPayOnDeliver,this.isAppCart=!!t.isAppCart,this.onSwipeEnd=t.onSwipeEnd},events:{"click .check-container":"onCheckClick","click .delete-btn":"onDeleteClicked","click .js-goods-link":"onGoodsLinkClick"},swipeStatus:function(){var t,e,i=this,n=0,o=0,s=!1,r=60,a=!1,l=function(t){e=e||-.38*this.width(),e>t||(this.css("-webkit-transform","translate3d("+t+"px, 0, 0)"),this.css("transform","translate3d("+t+"px, 0, 0)"))},c=function(){l.call(this,-60),this.addClass("ajust"),s=!0},h=function(){l.call(this,0),s=!1};return function(e,d,u,p,m){if(("up"==u||"down"==u)&&(a=!0,t&&clearTimeout(t),t=setTimeout(function(){a=!1},500)),!this.hasClass("editing")&&!a)if("start"==d&&(this.removeClass("ajust"),s&&l.call(this,-1*r),n=this.offset().left,o=n),"move"!=d||"left"!=u&&"right"!=u)("cancel"==d||"end"==d)&&(i.onSwipeEnd(),s?p>20&&"right"==u?h.call(this):c.call(this):p>60&&"left"==u?c.call(this):h.call(this));else if(s){o=p;var f="left"==u?n-p:n+p;f>0&&(f=0),l.call(this,f)}else{if(p>o&&"right"==u)return void l.call(this,0);o=p,l.call(this,-1*(n+p))}}},onDeleteFlagged:function(){(this.nCheck.hasClass("delete")||this.notShowCheckBox)&&this.model.destroy().done(this.onDeleteFinish)},onRemoveFlagged:function(t){var e=this.model;(this.nCheck.hasClass("delete")||this.notShowCheckBox)&&e.trigger("destroy",e,e.collection,t),this.onDeleteFinish()},deleteItem:function(){this.model.destroy().done(this.onDeleteFinish)},onDeleteClicked:function(){"function"==typeof this.beforeItemDelete?this.beforeItemDelete(this.model,_(this.deleteItem).bind(this)):this.deleteItem()},onCheckClick:function(t){if(this.model.editing)this.model.set("delete",!this.model.get("delete"));else{if(this.model.disabled)return;if(!this.model.isCheckable())return;this.model.set("checked",!this.model.get("checked"))}},onGoodsLinkClick:function(t){if(this.isAppCart&&!this.model.editing){t.preventDefault(),t.stopPropagation();var e=this.model.get("alias"),i=s.add(this.goodsLink,{alias:e});o.gotoWebview({url:i,page:"web"})}},onEditStart:function(t){this.model.editing=!0,this.model.set({"delete":!1},{silent:!0})},onEditFinish:function(t){this.model.editing=!1},doUpdateNum:function(){this.quantityView&&this.model.set("num",this.quantityView.getNum())},updateCheck:function(t,e){t?this.nCheck.addClass(e):this.nCheck.removeClass(e)},onNumChange:function(t){this.model.save({num:t},{patch:!0})},render:function(){var t=this;this.$el.html(this.template(_.extend({data:this.model.toJSON()},{getCdnImageUrl:window.Utils.getCdnImageUrl,getGoodsLink:function(){var e=t.model.get("alias");return s.add(t.goodsLink,{alias:e})},goodsDisabled:function(){var e=t.model.get("error_code");return e&&t.disableCode[e]?!0:!1},isEditing:this.model.editing,notShowCheckBox:this.notShowCheckBox,notShowNum:this.notShowNum,notShowPrice:this.notShowPrice})))[this.model.editing?"addClass":"removeClass"]("editing"),this.nCheck=this.$(".check"),this.nErrorBox=this.$(".error-box"),this.model.get("error_code")&&this.model.trigger("change",{name:"error"});var e=this.$(".js-ellipsis"),o=e.find("i");if(setTimeout(function(){n.multiEllipsis(e,o)}),this.model.editing){if(this.$el.addClass("editing"),!this.quantityView){var r=this.model.get("limit_num")||0,a=this.model.get("stock_num"),l="stock";r>0&&r>a?l="limit":r=a,this.quantityView=new i({el:this.$(".num"),onNumChange:_(this.onNumChange).bind(this),limitNum:r,onOverLimit:_(this.onOverLimit).bind(this,r,l),disabled:this.model.disabled,num:this.model.get("num")}).render()}return this}},onChange:function(){var t=function(){this.model.disabled=!0,this.model.set({checked:!1,"delete":!1}),this.updateCheck(!1,"checked"),this.updateCheck(!1,"delete"),this.model.editing||(this.updateCheck(!0,"info"),this.stopListening(),this.listenTo(this,"edit:start",this.onEditStart))},e=function(){var t=+this.model.get("limitNum"),e=+this.model.get("num");!this.model.editing&&e>t&&this.updateCheck(!0,"info")},i={11021:function(){var t=+this.model.get("lastest_stock");t>0&&this.model.set({limitNum:t}),this.model.set("checked",!1),e.call(this)},11010:function(){var t=this.model.get("pay_price")||0;t=+this.model.get("lastest_price"),!!t&&this.model.trigger("change",{name:"price",value:t}),this.model.set("checked",!1)},11015:function(){var t=this.model.get("error_msg"),i=/^该商品每人限购(.+)件.+$/.exec(t);i=parseInt(i?i[1]:-1,10),i>0&&this.model.set({limitNum:i}),this.model.set("checked",!1),e.call(this)}},n={11021:function(){return"仅剩"+this.model.get("lastest_stock")+"件"},11010:"价格已变动",11015:function(){var t=this.model.get("limitNum"),e=t>=0?"限购"+t+"件":"";return e}},o=function(t){var e=n[t];if(e){if(_.isString(e))return e;var i=e.call(this);return this.model.set("limitNumMsg",i),i}},s=function(t){var e=this.disableCode[t]||o.call(this,t)||this.model.get("error_msg");this.$el.addClass("error"),this.disableCode[t]&&this.$el.addClass("disabled"),this.nErrorBox.html(e)},r=function(e){return this.disableCode[e]?t:i[e]?i[e]:void 0},a=function(){var t=this.model.get("error_code"),e=r.call(this,t);e&&e.call(this),s.call(this,t)};return function(t){if(t)if(t.changed||!t.name){var e=t;if("num"in e.changed){var i=+this.model.get("num");this.model.editing||this.$(".num .num-txt").html(i)}else"checked"in e.changed?this.updateCheck(this.model.get("checked"),"checked"):"delete"in e.changed?this.updateCheck(this.model.get("delete"),"delete"):"error_code"in e.changed&&a.call(this)}else switch(t.name){case"price":this.$(".price span").html(t.value);break;case"error":a.call(this)}}}()})}),define("text!wap/components/new_cart/goods_list/templates/goodsList.html",[],function(){return'<div class="header">\n    <div class="select-group js-select-group">\n        <span class="check"></span>\n    </div>\n	<a class="shop-title" href="<%= data.shopUrl %>"><i class="custom-store-img">店铺：</i><%= data.teamName %></a>\n	<a href="javascript:;" data-type="cart" class="j-edit-list pull-right c-blue font-size-12 edit-list <% if(data.index>0) { %>hide<% } %>">编辑</a>\n</div>\n<% if (data.onlyPayOnDeliver) { %>\n	<div class="tips center">\n        该店铺仅支持货到付款，请单独下单购买\n    </div>\n<% } %>\n<ul class="js-list block block-list block-list-cart border-0"></ul>'}),define("zenjs/backbone/base_view",["require","backbone","../core/trigger_method"],function(t){var e=t("backbone"),i=t("../core/trigger_method");return e.View.extend({clean:function(){return this.stopListening(),this},triggerMethod:i})}),define("bower_components/zenlist/list",["require","exports","module","zenjs/backbone/base_view"],function(t,e,i){var n=function(){},o=t("zenjs/backbone/base_view");i.exports=o.extend({initialize:function(t){return this.options=t=t||{},this.items=[],this.itemView=t.itemView,this.itemOptions=t.itemOptions||{},this.collection=t.collection,this.onAfterListChange=t.onAfterListChange||n,this.onAfterListLoad=t.onAfterListLoad||n,this.onAfterListDisplay=t.onAfterListDisplay||n,this.onListEmpty=t.onListEmpty||t.onEmptyList||this._onListEmpty,this.onItemClick=t.onItemClick||n,this.onViewItemAdded=t.onViewItemAdded||n,this.displaySize=t.displaySize||-1,this.emptyHTML=t.emptyHTML||"",this.emptyText=t.emptyText||"列表为空",this},render:function(t){return this.displaySize=-1==(t||{}).displaySize?-1:this.displaySize,this.clean(),this._setupListeners(),this.addAll(),this.onAfterListDisplay({list:this.collection}),this},fetchRender:function(t){return this.collection.fetch({data:t,success:_(function(t,e){this.render(),this.onAfterListLoad(this.collection,e),this.onFetchSuccess&&this.onFetchSuccess()}).bind(this),error:_.bind(function(){this.onAfterListLoad(this.collection,response)},this)}),this},_setupListeners:function(){this.collection&&(this.stopListening(this.collection),this.listenTo(this.collection,"add",this.addItem,this),this.listenTo(this.collection,"reset sort",this.render,this),this.listenTo(this.collection,"remove",this.onItemRemoved,this))},addItemListeners:function(t){var e=this;this.listenTo(t,"all",function(){var e="item:"+arguments[0],i=_.toArray(arguments);i.splice(0,1),i.unshift(e,t),this.trigger.apply(this,i),"item:click"==e&&this.onItemClick()}),this.listenTo(t.model,"change",function(){e.onAfterListChange({list:this.collection})})},addAll:function(){0===this.collection.length?this.fetching||this.triggerMethod("list:empty"):this.collection.each(function(t){this.addItem(t)},this)},removeAll:function(){for(var t=this.items.length-1;t>=0;t--)this.removeView(this.items[t]);this.onAfterListChange({list:this.collection})},addItem:function(t,e,i){if(!(this.displaySize>=0&&this.items.length>=this.displaySize)){1==this.collection.length&&(this.listEl||this.$el).html("");var n=new this.itemView(_.extend({},this.options.itemOptions,{model:t,index:this.collection.indexOf(t)}));this.items.push(n),this.addItemListeners(n),n.render(),this.onViewItemAdded({list:this.items,viewItem:n,model:t});var o=(i||{}).at;return 0===o?(this.listEl||this.$el).prepend(n.el):(this.listEl||this.$el).append(n.el),n}},removeItem:function(t){var e=this.getViewByModel(t);e&&this.removeView(e)},removeView:function(t){var e;this.stopListening(t),t&&(this.stopListening(t.model),t.remove(),e=this.items.indexOf(t),this.items.splice(e,1)),0===this.collection.length&&(this.fetching||this.triggerMethod("list:empty"))},onItemRemoved:function(t){this.onAfterListChange({list:this.collection,action:"remove",model:t}),this.removeItem(t)},getViewByModel:function(t){return _.find(this.items,function(e,i){return e.model===t})},dispatchEventToAllViews:function(t,e){for(var i=this.items.length-1;i>=0;i--)this.items[i].trigger(t,e)},remove:function(){o.prototype.remove.call(this,arguments),this.removeAll(),this.collection.reset(),delete this.collection},clean:function(){o.prototype.clean.call(this,arguments),this.removeAll(),(this.listEl||this.$el).html(""),this.stopListening(this.collection)},_onListEmpty:function(){this.$el.html(this.emptyHTML||(this.emptyText?'<p style="text-align:center;line-height:60px;">'+this.emptyText+"</p>":""))}})}),define("wap/components/new_cart/goods_list/main",["require","./collections/goods_list","./views/goods_item","text!./templates/goodsList.html","bower_components/zenlist/list","backbone","underscore","jquery","bower_components/youzanjsbridge/api"],function(t){var e=t("./collections/goods_list"),i=t("./views/goods_item"),n=t("text!./templates/goodsList.html"),o=t("bower_components/zenlist/list"),s=t("backbone"),r=t("underscore"),a=t("jquery"),l=window.motify,c=t("bower_components/youzanjsbridge/api");return s.View.extend({events:{"click .j-edit-list":"onEditCartClick","click .js-select-group":"onSelectGroup","click .show-more":"showAll"},initialize:function(t){this.goodsListTpl=t.goodsListTpl||n,this.$el.html(r.template(this.goodsListTpl)({data:{teamName:t.store_name||t.title,shopUrl:t.shop_url,onlyPayOnDeliver:t.onlyPayOnDeliver}})),this.setEditing(!1),this.ajaxing=!1,this.nList=t.listName&&this.$(t.listName)||this.$(".js-list"),this.nEditBtn=this.$(".j-edit-list"),this.nSelectGroup=this.$(".js-select-group .check"),this.emptyListHtml=t.emptyListHtml,this.onEditingChange=t.onEditingChange,this.onNoGoods=t.onNoGoods,this.canShowEmtpyTips=t.canShowEmtpyTips,this.isAppCart=t.isAppCart,this.onSwipeEnd=t.onSwipeEnd,this.listViewOpt=t.listViewOptions||{},this.collection=t.collection||new e(t.items||[],t.collectionOptions),this.goodListOpt=r.extend({},this.listViewOpt,{el:this.nList,perPage:10,offset:200,collection:this.collection,displaySize:t.displaySize,itemView:t.GoodsItemView||i,itemOptions:r.extend({},t.goodsItemOptions,{shop_kdt_id:t.shop_kdt_id,onlyPayOnDeliver:"undefined"==typeof t.onlyPayOnDeliver?!1:t.onlyPayOnDeliver,onSwipeEnd:r(this.onSwipeEnd).bind(this),onDeleteFinish:r(this.onDeleteFinish).bind(this)}),onAfterListLoad:r(this.onAfterListLoad).bind(this),onAfterListChange:r(this.onAfterListChange).bind(this),onListEmpty:r(this.onListEmpty).bind(this)
}),this.goodsList=this.collection,this.goodsListView=new o(this.goodListOpt),this.listView=this.goodsListView,this.listView.render(),0===this.goodsList.length&&this.nEditBtn.hide(),this.goodsListView.on("finished",r(this._onFinished).bind(this)),this.deleteBatchUrl=t.deleteBatchUrl||"",this.deleteBatchIdName=t.deleteBatchIdName||"id"},onAfterListChange:function(t){var e=!0,i=this.getCheckBoxClassName();this.trigger("after:list:change",t),this.goodsList.length>0&&(this.nEditBtn.removeClass("disable"),this.goodsList.forEach(function(t){t.get(i)||(e=!1)}),e?this.nSelectGroup.addClass(i):this.nSelectGroup.removeClass("checked").removeClass("delete")),this.listViewOpt.onAfterListChange&&this.listViewOpt.onAfterListChange(t)},onAfterListLoad:function(t){this.goodsList.length>0?(this.nEditBtn.removeClass("disable"),this.goodListOpt.displaySize>=0&&this.goodsList.length>this.goodListOpt.displaySize&&this.goodListOpt.el.append(a('<p class="show-more c-gray-dark">查看剩余'+(this.goodsList.length-this.goodListOpt.displaySize)+"件商品</p>"))):this.nEditBtn.hide(),this.listViewOpt.onAfterListLoad&&this.listViewOpt.onAfterListLoad(t)},doFinishEditing:function(t){this.setEditing(!1),this.listView.dispatchEventToAllViews("edit:finish",{name:"edit:finish"}),this.showAll(),this.nEditBtn.text("编辑"),this.nEditBtn.removeClass("editing"),t&&this.trigger("editing:change",{editing:!1,view:this})},onListEmpty:function(t){this.remove()},onEditCartClick:function(t){var e=a(t.target).data("type");this.doClickEditCart(!0,e)},onDeleteFinish:function(){this.setEditing(!1,!0),c.doAction({action:"cart_num_update"})},doClickEditCart:function(t,e){(this.isEditing||0!==this.goodsList.length)&&(this.editing?this.doFinishEditing(t):("cart"==e&&window.Logger&&window.Logger.log({fm:"click",title:"cart_edit"}),this.setEditing(!0,t),this.listView.dispatchEventToAllViews("edit:start",{name:"edit:start"}),this.showAll(),this.nEditBtn.text("完成"),this.nEditBtn.addClass("editing")))},showAll:function(){this.listView.render({displaySize:-1}),this.$(".show-more").remove()},setEditing:function(t,e){this.editing!=t&&(this.editing=t,this.onEditingChange&&this.onEditingChange(t),this.goodsListView&&(this.goodsListView.collection.isEditing=t),e&&this.trigger("editing:change",{editing:t,view:this}))},onDeleteAll:function(t){var e=this.goodsListView.collection.where({"delete":!0});if(0!=e.length){if(1==e.length)return this.beforeRemoveItems({deleteNum:1}),void this.listView.dispatchEventToAllViews("delete:flagged",t);var i=[];e.forEach(function(t){i.push({sku_id:t.get("sku_id"),goods_id:t.get("goods_id")})}),a.post(this.deleteBatchUrl,{ids:i}).done(r(function(e){0==e.code?(l.log("成功删除 "+i.length+" 个"),this.beforeRemoveItems({deleteNum:i.length}),this.listView.dispatchEventToAllViews("remove:flagged",t)):l.log(e.msg)}).bind(this)).fail(function(){l.log("oops, 出错了")})}},beforeRemoveItems:function(t){"waterfall"!==this.listViewOpt.listType||this.goodsListView.finished||(this.goodsListView.total&&(this.goodsListView.total-=t.deleteNum),this.goodsListView.fetchMore())},_onFinished:function(){this.trigger("finished")},onSelectGroup:function(){var t=this.getCheckBoxClassName(),e=this.nSelectGroup.hasClass(t);this.nSelectGroup[e?"removeClass":"addClass"](t),this.collection.updateAllCheck(!e,t)},getCheckBoxClassName:function(){return this.editing?"delete":"checked"}})}),define("zenjs/util/number",[],function(){var t={makeRandomString:function(t){var e="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";t=t||10;for(var n=0;t>n;n++)e+=i.charAt(Math.floor(Math.random()*i.length));return e}};return t}),define("bower_components/pop/pop",["require","zenjs/events","zenjs/util/number"],function(t){var e=function(){},i=t("zenjs/events"),n=t("zenjs/util/number");window.zenjs=window.zenjs||{};var o=i.extend({init:function(t){this._window=$(window);var i=n.makeRandomString();$("body").append('<div id="'+i+'"                 style="display:none; height: 100%;                 position: fixed; top: 0; left: 0; right: 0;                background-color: rgba(0, 0, 0, '+(t.transparent||".9")+');z-index:1000;opacity:0;transition: opacity ease 0.2s;"></div>'),this.nBg=$("#"+i),this.nBg.on("click",$.proxy(function(){this.isCanNotHide||this.hide()},this));var o=n.makeRandomString();$("body").append('<div id="'+o+'" class="'+(t.className||"")+'" style="overflow:hidden;visibility: hidden;"></div>'),this.nPopContainer=$("#"+o),this.nPopContainer.hide(),this.nPopContainer.css({opacity:0,position:"absolute","z-index":1e3}),t.contentViewClass&&(this.contentViewClass=t.contentViewClass,this.contentViewOptions=$.extend({el:this.nPopContainer},t.contentViewOptions||{}),this.contentView=new this.contentViewClass($.extend({onHide:$.proxy(this.hide,this)},this.contentViewOptions)),this.contentView.onHide=$.proxy(this.hide,this)),this.animationTime=t.animationTime||300,this.isCanNotHide=t.isCanNotHide,this.doNotRemoveOnHide=t.doNotRemoveOnHide||!1,this.onShow=t.onShow||e,this.onHide=t.onHide||e,this.onFinishHide=t.onFinishHide||e,this.html=t.html},render:function(t){return this.renderOptions=t||{},this.contentViewClass?this.contentView.render(this.renderOptions):this.html&&this.nPopContainer.html(this.html),this},show:function(){return this.nBg.show().css({opacity:"1","transition-property":"none"}),this.nPopContainer.show(),this.trigger("pop:show:before"),setTimeout($.proxy(function(){this.trigger("pop:show:after"),this.nPopContainer.show().css("visibility","visible"),this._doShow&&this._doShow(),this.onShow()},this),200),this},hide:function(t){t=t||{};var e=t.doNotRemove||this.doNotRemoveOnHide||!1;this._doHide&&this._doHide(),this.trigger("pop:hide:before"),setTimeout($.proxy(function(){this.nBg.css({opacity:0,"transition-property":"opacity"}),this.trigger("pop:hide:after"),setTimeout($.proxy(function(){this.nBg.hide(),this.nPopContainer.hide(),e||this.destroy()},this),200)},this),this.animationTime),this.onHide()},destroy:function(){return this.nPopContainer.remove(),this.nBg.remove(),this.contentView&&this.contentView.remove(),this}});return o}),define("bower_components/pop/pop_forbid_scroll",["require","./pop"],function(t){window.zenjs=window.zenjs||{};var e=t("./pop"),i=e.extend({init:function(t){this._super(t),this.on("pop:show:before",$.proxy(this.onBeforePopShow,this)),this.on("pop:show:after",$.proxy(this.onAfterPopShow,this)),this.on("pop:hide:after",$.proxy(this.onAfterPopHide,this))},onBeforePopShow:function(){this.top=this._window.scrollTop()},onAfterPopShow:function(){this._window.scrollTop(0),this.startShow()},onAfterPopHide:function(){var t,e=function(i){return t!==this._window.scrollTop()&&i>0?(this._window.scrollTop(t),void setTimeout($.proxy(e,this,i-1))):void setTimeout($.proxy(this.onFinishHide,this),50)};return function(){this.startHide(),t=this.top,this._window.scrollTop(t),$.proxy(e,this)(2),setTimeout($.proxy(function(){window.zenjs.popList.length<1&&$("html").css("position",this.htmlPosition)},this),200)}}(),startShow:function(){var t=window.zenjs.popList;if(t||(t=window.zenjs.popList=[]),0===t.length){var e=$("body"),i=$("html");this.htmlPosition=i.css("position"),i.css("position","relative"),this.bodyCss=(e.prop("style")||{}).cssText,this.htmlCss=(i.prop("style")||{}).cssText,$("body,html").css({overflow:"hidden",height:this._window.height()})}t.indexOf(this)<0&&t.push(this)},startHide:function(){var t=window.zenjs.popList,e=t.indexOf(this);e>-1&&t.splice(e,1),t.length<1&&($("html").attr("style",this.htmlCss||""),$("body").attr("style",this.bodyCss||""))}});return i}),define("bower_components/pop/popout",["require","./pop_forbid_scroll"],function(t){var e=t("./pop_forbid_scroll"),i=e.extend({init:function(t){t=t||{},this._super(t),this.css=$.extend({transition:"opacity ease "+this.animationTime+"ms",top:"50%",left:"50%","-webkit-transform":"translate3d(-50%, -50%, 0)",transform:"translateY(-50%, -50%, 0)"},t.css||{}),this.nPopContainer.css(this.css)},_doShow:function(){$(".js-popout-close").click($.proxy(function(t){this.hide()},this)),this.nPopContainer.css("opacity",1),this.nPopContainer.show()},_doHide:function(t){this.nPopContainer.css({opacity:0})}});return i}),define("bower_components/pop/popout_box",["require","./popout"],function(t){var e=function(){},i=t("./popout"),n=i.extend({init:function(t){this._super(t),this._onOKClicked=t.onOKClicked||e,this._onCancelClicked=t.onCancelClicked||e,this.preventHideOnOkClicked=t.preventHideOnOkClicked||!1,this.width=t.width,this.setEventListener()},setEventListener:function(){this.nPopContainer.on("click",".js-ok",$.proxy(this.onOKClicked,this)),this.nPopContainer.on("click",".js-cancel",$.proxy(this.onCancelClicked,this))},_doShow:function(){this.boxCss={"border-radius":"4px",background:"white",width:this.width||"270px",padding:"15px"},this.nPopContainer.css(this.boxCss).addClass("popout-box"),this._super()},_doHide:function(t){this._super()},onOKClicked:function(t){this._onOKClicked(t),!this.preventHideOnOkClicked&&this.hide()},onCancelClicked:function(t){this._onCancelClicked(t),this.hide()}});return n}),define("text!bower_components/pop/pop_confirm/box.html",[],function(){return'<% if (title) { %>\n<h1 class="center font-size-16"><%= title %></h1>\n<% } %>\n<div class="confirm-content font-size-14<% if (title) { %> c-gray-dark<% } %>" style="line-height: 20px; padding: 5px 5px 10px;">\n    <%= content %>\n</div>\n<hr style="margin: 10px -15px;" />\n<div class="btn-2-1">\n    <p class="js-cancel center font-size-16" style="padding-top: 5px;"><%= cancelBtn %></p>\n</div><div class="btn-2-1">\n    <p class="js-ok center c-green font-size-16" style="padding-top: 5px;"><%= okBtn %></p>\n</div>'}),define("zenjs/util/template",["require","jquery"],function(t){var e=t("jquery"),i=function(){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"},e=["&","<",">",'"',"'"],i=new RegExp("["+e.join("")+"]","g");return function(e){return null==e?"":(""+e).replace(i,function(e){return t[e]})}}(),n={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g},o=/(.)^/,s={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},r=/\\|'|\r|\n|\t|\u2028|\u2029/g,a=function(t,a,l){var c;l=e.extend({},n,l);var h=new RegExp([(l.escape||o).source,(l.interpolate||o).source,(l.evaluate||o).source].join("|")+"|$","g"),d=0,u="__p+='";t.replace(h,function(e,i,n,o,a){return u+=t.slice(d,a).replace(r,function(t){return"\\"+s[t]}),i&&(u+="'+\n((__t=("+i+"))==null?'':escapeFunc(__t))+\n'"),n&&(u+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),o&&(u+="';\n"+o+"\n__p+='"),d=a+e.length,e}),u+="';\n",l.variable||(u="with(obj||{}){\n"+u+"}\n"),u="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+u+"return __p;\n";try{c=new Function(l.variable||"obj","escapeFunc",u)}catch(p){throw p.source=u,p}if(a)return c(a,i);var m=function(t){return c.call(this,t,i)};return m.source="function("+(l.variable||"obj")+"){\n"+u+"}",m};return a}),define("bower_components/pop/pop_confirm/popout_confirm",["require","../popout_box","text!../pop_confirm/box.html","zenjs/util/template"],function(t){var e=t("../popout_box"),i=t("text!../pop_confirm/box.html"),n=t("zenjs/util/template"),o=n(i),s=e.extend({init:function(t){this._super(t),this.isCanNotHide=!0,this.title=t.title||"",this.content=t.content||"",this.okBtn=t.okBtn||"确定",this.cancelBtn=t.cancelBtn||"取消"},render:function(t){return this.html||(this.html=o({title:this.title,content:this.content,okBtn:this.okBtn,cancelBtn:this.cancelBtn})),this._super(t),this.nPopContainer.addClass("popout-confirm"),this}}),r=null;return{show:function(t,e){e=e||{},r&&this.hide(),e.content=t,r=new s(e).render().show()},hide:function(){r&&(r.hide(),r=null)}}}),define("wap/components/new_cart/shop_list/main",["require","wap/components/new_cart/goods_list/main","wap/components/new_cart/goods_list/collections/goods_list","bower_components/pop/pop_confirm/popout_confirm","zenjs/util/args"],function(t){var e=t("wap/components/new_cart/goods_list/main"),i=t("wap/components/new_cart/goods_list/collections/goods_list"),n=t("bower_components/pop/pop_confirm/popout_confirm"),o=t("zenjs/util/args");return Backbone.View.extend({className:"block bottom-0",initialize:function(t){this.items=[],this.index=t.index,this.url=t.url,this.isAppCart=t.isAppCart,this.isFromConfrimMerge=t.isFromConfrimMerge,this.deleteBatchUrl=t.deleteBatchUrl,this.deleteBatchIdName=t.deleteBatchIdName,this.bottomView=t.bottomView,this.goodsListInShop=new i([],{modelUrlRoot:this.url,kdt_id:this.model.get("kdt_id")}),this.listenTo(this.goodsListInShop,"remove",this.checkEmpty,this),this.onEditingChange=t.onEditingChange,this.onSwipeEnd=t.onSwipeEnd},render:function(){var t=this.model.get("pay_ways"),s=t&&1===t.length&&9===+t[0].key,r=this.model.get("goods_list"),a=this.model.get("shop_url"),l=window._global.offline_id||0,c=new i(r,{modelUrlRoot:this.url,kdt_id:this.model.get("kdt_id")});l&&(a=o.add(a,{oid:l}));var h=new e({className:"block block-order block-cart",collection:c,title:this.model.get("title"),store_name:this.model.get("store_name"),deleteBatchUrl:this.deleteBatchUrl,deleteBatchIdName:this.deleteBatchIdName,canShowEmtpyTips:_(this.canShowEmtpyTips).bind(this),shop_kdt_id:this.model.get("kdt_id"),shop_url:a,onlyPayOnDeliver:s,goodsItemOptions:{isAppCart:this.isAppCart,onOverLimit:function(t,e){"limit"===e?motify.log("该商品每人限购"+t+"件"):"stock"===e&&motify.log("就这么几件啦～")},beforeItemDelete:function(t,e){n.show("确认要删除该商品吗？",{onOKClicked:function(){e()}})}},onSwipeEnd:_(this.onSwipeEnd).bind(this)});return r.length>0&&this.$el.append(h.$el),h.on("after:list:change",_(this.updateBottom).bind(this)),h.on("after:list:empty",_(this.onListEmpty).bind(this)),h.on("editing:change",_(this.editingChange).bind(this)),this.items.push(h),this.bottomView.goodsList.add(c.models),this.goodsListInShop.add(c.models),this},canShowEmtpyTips:function(){return 0==this.bottomView.goodsList.length},onListEmpty:function(t){this.$(".j-edit-list").first().removeClass("hide"),this.updateBottom()},updateBottom:function(t){var t=t||{};"remove"==t.action&&this.bottomView.goodsList.remove(t.model),this.bottomView.update(t)},editingChange:function(t){this.items.forEach(function(e){e!=t.view&&e.doClickEditCart(!1,t.editing)}),this.setBottomEditing(t),this.onEditingChange({editing:t.editing,view:this})},setBottomEditing:function(t){this.bottomView.off("delete:click"),this.bottomView.off("cancel_delete:click"),this.bottomView.on("delete:click",_(this.onDeleteClicked).bind(this)),this.bottomView.on("cancelDelete:click",_(this.onCancelDeleteClicked).bind(this)),t.editing&&(this.bottomView.goodsList=this.goodsListInShop),this.bottomView.setEditing(t.editing),this.bottomView.update()},onDeleteClicked:function(){var t=0,e=this.items.length;this.items.forEach(function(e){t+=e.collection.where({"delete":!0}).length}),n.show("确认将所选 "+t+" 个商品删除？",{onOKClicked:_(function(){for(var t=e-1;t>=0;t--)this.items[t].onDeleteAll()}).bind(this)})},onCancelDeleteClicked:function(){this.items.forEach(function(t){t.onEditCartClick()})},checkEmpty:function(){0==this.goodsListInShop.length&&this.remove()},hideEditBtn:function(){this.editing||this.$(".j-edit-list").hide()},showEditBtn:function(){this.$(".j-edit-list").show()}})}),define("wap/components/new_cart/shop_list/models/shop",["require","exports","module","backbone"],function(t,e,i){var n=t("backbone");i.exports=n.Collection.extend({comparator:function(t,e){return+t.get("latest_addcart_timestamp")<+e.get("latest_addcart_timestamp")?1:-1}})}),define("text!wap/components/new_cart/invalid_goods_list/templates/goodsList.html",[],function(){return'<p class="block invalid-list-title">\n    以下商品无法一起购买\n</p>\n<div class="block block-list-cart block-order border-top-0">\n    <ul class="block border-0 invalid-list js-invalid-list"></ul>\n    <div class="center clear-block"><button class="btn clear-btn js-clear">清空失效商品</button></div>\n</div>'}),define("wap/components/new_cart/invalid_goods_list/main",["require","text!./templates/goodsList.html","wap/components/new_cart/goods_list/main","bower_components/pop/pop_confirm/popout_confirm","bower_components/youzanjsbridge/api","underscore"],function(t){var e=t("text!./templates/goodsList.html"),i=t("wap/components/new_cart/goods_list/main"),n=t("bower_components/pop/pop_confirm/popout_confirm"),o=(t("bower_components/youzanjsbridge/api"),t("underscore"));return i.extend({events:{"click .js-clear":"onClearClick"},initialize:function(t){t=o.defaults(t,{listName:".js-invalid-list",goodsListTpl:e,goodsItemOptions:{notShowCheckBox:!0,notShowPrice:!0,className:"block-item block-item-cart error",beforeItemDelete:function(t,e){n.show("确认要删除该商品吗？",{onOKClicked:function(){e()}})}}}),this.$el.addClass("error"),i.prototype.initialize.apply(this,[t])},clearAllGoods:function(){var t=[],e=this.goodListOpt.collection;e.forEach(function(e){t.push({sku_id:e.get("sku_id"),goods_id:e.get("goods_id")})}),$.post(this.deleteBatchUrl,{ids:t}).done(o(function(e){0==e.code?(this.listView.dispatchEventToAllViews("remove:flagged"),motify.log("成功清空 "+t.length+" 个失效商品")):motify.log(e.msg)}).bind(this)).fail(function(){motify.log("oops, 出错了")})},onClearClick:function(t){n.show("确认清空失效商品吗？",{onOKClicked:o(this.clearAllGoods).bind(this)})}})}),define("text!wap/components/new_cart/templates/empty.html",[],function(){return'<div class="empty-list-content"><a href="<%= homepage %>" class="js-go-home home-page tag tag-big tag-orange">去逛逛</a></div>\n'}),define("text!wap/components/new_cart/templates/emptyListTpl.html",[],function(){return'\n<div class="empty-list <%= className %>" style="<%= style %>">\n    <!-- 文本 -->\n    <div class="empty-list-header">\n        <h4>购物车快饿瘪了 T.T</h4>\n        <% if (typeof(link) != "undefined") { %>\n            <a href="<%= link %>"><%= text %></a>\n        <% } else if(typeof(text) != "undefined") { %>\n            <span><%= text %></span>\n        <% } %>\n    </div>\n    <!-- 自定义html，和上面的可以并存 -->\n    <% if (typeof(html) != "undefined") { %>\n        <%= html %>\n    <% } %>\n</div>\n'}),define("text!wap/components/new_cart/templates/login_tip.html",[],function(){return'<div class="js-login-tip block login-tip font-size-12">\n	<% if (!isAppCart) { %>\n		<i class="js-close-login close-btn"></i>\n		绑定手机号可保存购物车中所有商品\n		<a href="javascript:void(0)" class="js-login-btn btn login-btn">立即绑定</a>\n	<% } else { %>\n		登录后你可以保存购物车中的所有商品\n		<a href="javascript:void(0)" class="js-login-btn btn login-btn" style="padding: 3px 10px;">登录</a>\n	<% } %>\n</div>'}),define("text!wap/components/new_cart/templates/close_warn.html",[],function(){return'<div class="close-pop-box text-center">\n	<h3 class="font-size-18">\n		提醒\n	</h3>\n	<p class="font-size-14">绑定手机号，有助于订单查询哦～</p>\n	<div class="action-container">\n		<div class="btn-2-1">\n			<button class="btn btn-white font-size-14 js-cancel">我知道了</button>\n		</div>\n		<div class="btn-2-1">\n			<button class="btn btn-green font-size-14 js-ok">明日再提醒</button>\n		</div>\n	</div>\n</div'}),define("bower_components/aes/aes",["require","exports","module"],function(t,e,i){var n=n||function(t,e){var i={},n=i.lib={},o=function(){},s=n.Base={extend:function(t){o.prototype=this;var e=new o;return t&&e.mixIn(t),e.hasOwnProperty("init")||(e.init=function(){e.$super.init.apply(this,arguments)}),e.init.prototype=e,e.$super=this,e},create:function(){var t=this.extend();return t.init.apply(t,arguments),t},init:function(){},mixIn:function(t){for(var e in t)t.hasOwnProperty(e)&&(this[e]=t[e]);t.hasOwnProperty("toString")&&(this.toString=t.toString)},clone:function(){return this.init.prototype.extend(this)}},r=n.WordArray=s.extend({init:function(t,i){t=this.words=t||[],this.sigBytes=i!=e?i:4*t.length},toString:function(t){return(t||l).stringify(this)},concat:function(t){var e=this.words,i=t.words,n=this.sigBytes;if(t=t.sigBytes,this.clamp(),n%4)for(var o=0;t>o;o++)e[n+o>>>2]|=(i[o>>>2]>>>24-8*(o%4)&255)<<24-8*((n+o)%4);else if(65535<i.length)for(o=0;t>o;o+=4)e[n+o>>>2]=i[o>>>2];else e.push.apply(e,i);return this.sigBytes+=t,this},clamp:function(){var e=this.words,i=this.sigBytes;e[i>>>2]&=4294967295<<32-8*(i%4),e.length=t.ceil(i/4)},clone:function(){var t=s.clone.call(this);return t.words=this.words.slice(0),t},random:function(e){for(var i=[],n=0;e>n;n+=4)i.push(4294967296*t.random()|0);return new r.init(i,e)}}),a=i.enc={},l=a.Hex={stringify:function(t){var e=t.words;t=t.sigBytes;for(var i=[],n=0;t>n;n++){var o=e[n>>>2]>>>24-8*(n%4)&255;i.push((o>>>4).toString(16)),i.push((15&o).toString(16))}return i.join("")},parse:function(t){for(var e=t.length,i=[],n=0;e>n;n+=2)i[n>>>3]|=parseInt(t.substr(n,2),16)<<24-4*(n%8);return new r.init(i,e/2)}},c=a.Latin1={stringify:function(t){var e=t.words;t=t.sigBytes;for(var i=[],n=0;t>n;n++)i.push(String.fromCharCode(e[n>>>2]>>>24-8*(n%4)&255));return i.join("")},parse:function(t){for(var e=t.length,i=[],n=0;e>n;n++)i[n>>>2]|=(255&t.charCodeAt(n))<<24-8*(n%4);return new r.init(i,e)}},h=a.Utf8={stringify:function(t){try{return decodeURIComponent(escape(c.stringify(t)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(t){return c.parse(unescape(encodeURIComponent(t)))}},d=n.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new r.init,this._nDataBytes=0},_append:function(t){"string"==typeof t&&(t=h.parse(t)),this._data.concat(t),this._nDataBytes+=t.sigBytes},_process:function(e){var i=this._data,n=i.words,o=i.sigBytes,s=this.blockSize,a=o/(4*s),a=e?t.ceil(a):t.max((0|a)-this._minBufferSize,0);if(e=a*s,o=t.min(4*e,o),e){for(var l=0;e>l;l+=s)this._doProcessBlock(n,l);l=n.splice(0,e),i.sigBytes-=o}return new r.init(l,o)},clone:function(){var t=s.clone.call(this);return t._data=this._data.clone(),t},_minBufferSize:0});n.Hasher=d.extend({cfg:s.extend(),init:function(t){this.cfg=this.cfg.extend(t),this.reset()},reset:function(){d.reset.call(this),this._doReset()},update:function(t){return this._append(t),this._process(),this},finalize:function(t){return t&&this._append(t),this._doFinalize()},blockSize:16,_createHelper:function(t){return function(e,i){return new t.init(i).finalize(e)}},_createHmacHelper:function(t){return function(e,i){return new u.HMAC.init(t,i).finalize(e)}}});var u=i.algo={};return i}(Math);!function(){var t=n,e=t.lib.WordArray;t.enc.Base64={stringify:function(t){var e=t.words,i=t.sigBytes,n=this._map;t.clamp(),t=[];for(var o=0;i>o;o+=3)for(var s=(e[o>>>2]>>>24-8*(o%4)&255)<<16|(e[o+1>>>2]>>>24-8*((o+1)%4)&255)<<8|e[o+2>>>2]>>>24-8*((o+2)%4)&255,r=0;4>r&&i>o+.75*r;r++)t.push(n.charAt(s>>>6*(3-r)&63));if(e=n.charAt(64))for(;t.length%4;)t.push(e);return t.join("")},parse:function(t){var i=t.length,n=this._map,o=n.charAt(64);o&&(o=t.indexOf(o),-1!=o&&(i=o));for(var o=[],s=0,r=0;i>r;r++)if(r%4){var a=n.indexOf(t.charAt(r-1))<<2*(r%4),l=n.indexOf(t.charAt(r))>>>6-2*(r%4);o[s>>>2]|=(a|l)<<24-8*(s%4),s++}return e.create(o,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),function(t){function e(t,e,i,n,o,s,r){return t=t+(e&i|~e&n)+o+r,(t<<s|t>>>32-s)+e}function i(t,e,i,n,o,s,r){return t=t+(e&n|i&~n)+o+r,(t<<s|t>>>32-s)+e}function o(t,e,i,n,o,s,r){return t=t+(e^i^n)+o+r,(t<<s|t>>>32-s)+e}function s(t,e,i,n,o,s,r){return t=t+(i^(e|~n))+o+r,(t<<s|t>>>32-s)+e}for(var r=n,a=r.lib,l=a.WordArray,c=a.Hasher,a=r.algo,h=[],d=0;64>d;d++)h[d]=4294967296*t.abs(t.sin(d+1))|0;a=a.MD5=c.extend({_doReset:function(){this._hash=new l.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(t,n){for(var r=0;16>r;r++){var a=n+r,l=t[a];t[a]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}var r=this._hash.words,a=t[n+0],l=t[n+1],c=t[n+2],d=t[n+3],u=t[n+4],p=t[n+5],m=t[n+6],f=t[n+7],g=t[n+8],v=t[n+9],w=t[n+10],_=t[n+11],b=t[n+12],y=t[n+13],k=t[n+14],C=t[n+15],x=r[0],j=r[1],S=r[2],E=r[3],x=e(x,j,S,E,a,7,h[0]),E=e(E,x,j,S,l,12,h[1]),S=e(S,E,x,j,c,17,h[2]),j=e(j,S,E,x,d,22,h[3]),x=e(x,j,S,E,u,7,h[4]),E=e(E,x,j,S,p,12,h[5]),S=e(S,E,x,j,m,17,h[6]),j=e(j,S,E,x,f,22,h[7]),x=e(x,j,S,E,g,7,h[8]),E=e(E,x,j,S,v,12,h[9]),S=e(S,E,x,j,w,17,h[10]),j=e(j,S,E,x,_,22,h[11]),x=e(x,j,S,E,b,7,h[12]),E=e(E,x,j,S,y,12,h[13]),S=e(S,E,x,j,k,17,h[14]),j=e(j,S,E,x,C,22,h[15]),x=i(x,j,S,E,l,5,h[16]),E=i(E,x,j,S,m,9,h[17]),S=i(S,E,x,j,_,14,h[18]),j=i(j,S,E,x,a,20,h[19]),x=i(x,j,S,E,p,5,h[20]),E=i(E,x,j,S,w,9,h[21]),S=i(S,E,x,j,C,14,h[22]),j=i(j,S,E,x,u,20,h[23]),x=i(x,j,S,E,v,5,h[24]),E=i(E,x,j,S,k,9,h[25]),S=i(S,E,x,j,d,14,h[26]),j=i(j,S,E,x,g,20,h[27]),x=i(x,j,S,E,y,5,h[28]),E=i(E,x,j,S,c,9,h[29]),S=i(S,E,x,j,f,14,h[30]),j=i(j,S,E,x,b,20,h[31]),x=o(x,j,S,E,p,4,h[32]),E=o(E,x,j,S,g,11,h[33]),S=o(S,E,x,j,_,16,h[34]),j=o(j,S,E,x,k,23,h[35]),x=o(x,j,S,E,l,4,h[36]),E=o(E,x,j,S,u,11,h[37]),S=o(S,E,x,j,f,16,h[38]),j=o(j,S,E,x,w,23,h[39]),x=o(x,j,S,E,y,4,h[40]),E=o(E,x,j,S,a,11,h[41]),S=o(S,E,x,j,d,16,h[42]),j=o(j,S,E,x,m,23,h[43]),x=o(x,j,S,E,v,4,h[44]),E=o(E,x,j,S,b,11,h[45]),S=o(S,E,x,j,C,16,h[46]),j=o(j,S,E,x,c,23,h[47]),x=s(x,j,S,E,a,6,h[48]),E=s(E,x,j,S,f,10,h[49]),S=s(S,E,x,j,k,15,h[50]),j=s(j,S,E,x,p,21,h[51]),x=s(x,j,S,E,b,6,h[52]),E=s(E,x,j,S,d,10,h[53]),S=s(S,E,x,j,w,15,h[54]),j=s(j,S,E,x,l,21,h[55]),x=s(x,j,S,E,g,6,h[56]),E=s(E,x,j,S,C,10,h[57]),S=s(S,E,x,j,m,15,h[58]),j=s(j,S,E,x,y,21,h[59]),x=s(x,j,S,E,u,6,h[60]),E=s(E,x,j,S,_,10,h[61]),S=s(S,E,x,j,c,15,h[62]),j=s(j,S,E,x,v,21,h[63]);r[0]=r[0]+x|0,r[1]=r[1]+j|0,r[2]=r[2]+S|0,r[3]=r[3]+E|0},_doFinalize:function(){var e=this._data,i=e.words,n=8*this._nDataBytes,o=8*e.sigBytes;i[o>>>5]|=128<<24-o%32;var s=t.floor(n/4294967296);for(i[(o+64>>>9<<4)+15]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),i[(o+64>>>9<<4)+14]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),e.sigBytes=4*(i.length+1),this._process(),e=this._hash,i=e.words,n=0;4>n;n++)o=i[n],i[n]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8);return e},clone:function(){var t=c.clone.call(this);return t._hash=this._hash.clone(),t}}),r.MD5=c._createHelper(a),r.HmacMD5=c._createHmacHelper(a)}(Math),function(){var t=n,e=t.lib,i=e.Base,o=e.WordArray,e=t.algo,s=e.EvpKDF=i.extend({cfg:i.extend({keySize:4,hasher:e.MD5,iterations:1}),init:function(t){this.cfg=this.cfg.extend(t)},compute:function(t,e){for(var i=this.cfg,n=i.hasher.create(),s=o.create(),r=s.words,a=i.keySize,i=i.iterations;r.length<a;){l&&n.update(l);var l=n.update(t).finalize(e);n.reset();for(var c=1;i>c;c++)l=n.finalize(l),n.reset();s.concat(l)}return s.sigBytes=4*a,s}});t.EvpKDF=function(t,e,i){return s.create(i).compute(t,e)}}(),n.lib.Cipher||function(t){var e=n,i=e.lib,o=i.Base,s=i.WordArray,r=i.BufferedBlockAlgorithm,a=e.enc.Base64,l=e.algo.EvpKDF,c=i.Cipher=r.extend({cfg:o.extend(),createEncryptor:function(t,e){return this.create(this._ENC_XFORM_MODE,t,e)},createDecryptor:function(t,e){return this.create(this._DEC_XFORM_MODE,t,e)},init:function(t,e,i){this.cfg=this.cfg.extend(i),this._xformMode=t,this._key=e,this.reset()},reset:function(){r.reset.call(this),this._doReset()},process:function(t){return this._append(t),this._process()},finalize:function(t){return t&&this._append(t),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(t){return{encrypt:function(e,i,n){return("string"==typeof i?f:m).encrypt(t,e,i,n)},decrypt:function(e,i,n){return("string"==typeof i?f:m).decrypt(t,e,i,n)}}}});i.StreamCipher=c.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var h=e.mode={},d=function(e,i,n){var o=this._iv;o?this._iv=t:o=this._prevBlock;for(var s=0;n>s;s++)e[i+s]^=o[s]},u=(i.BlockCipherMode=o.extend({createEncryptor:function(t,e){return this.Encryptor.create(t,e)},createDecryptor:function(t,e){return this.Decryptor.create(t,e)},init:function(t,e){this._cipher=t,this._iv=e}})).extend();u.Encryptor=u.extend({processBlock:function(t,e){var i=this._cipher,n=i.blockSize;d.call(this,t,e,n),i.encryptBlock(t,e),this._prevBlock=t.slice(e,e+n)}}),u.Decryptor=u.extend({processBlock:function(t,e){var i=this._cipher,n=i.blockSize,o=t.slice(e,e+n);i.decryptBlock(t,e),d.call(this,t,e,n),this._prevBlock=o}}),h=h.CBC=u,u=(e.pad={}).Pkcs7={pad:function(t,e){for(var i=4*e,i=i-t.sigBytes%i,n=i<<24|i<<16|i<<8|i,o=[],r=0;i>r;r+=4)o.push(n);i=s.create(o,i),t.concat(i)},unpad:function(t){t.sigBytes-=255&t.words[t.sigBytes-1>>>2]}},i.BlockCipher=c.extend({cfg:c.cfg.extend({mode:h,padding:u}),reset:function(){c.reset.call(this);var t=this.cfg,e=t.iv,t=t.mode;if(this._xformMode==this._ENC_XFORM_MODE)var i=t.createEncryptor;else i=t.createDecryptor,this._minBufferSize=1;this._mode=i.call(t,this,e&&e.words)},_doProcessBlock:function(t,e){this._mode.processBlock(t,e)},_doFinalize:function(){var t=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){t.pad(this._data,this.blockSize);var e=this._process(!0)}else e=this._process(!0),t.unpad(e);return e},blockSize:4});var p=i.CipherParams=o.extend({init:function(t){this.mixIn(t)},toString:function(t){return(t||this.formatter).stringify(this)}}),h=(e.format={}).OpenSSL={stringify:function(t){var e=t.ciphertext;return t=t.salt,(t?s.create([1398893684,1701076831]).concat(t).concat(e):e).toString(a)},parse:function(t){t=a.parse(t);var e=t.words;if(1398893684==e[0]&&1701076831==e[1]){var i=s.create(e.slice(2,4));e.splice(0,4),t.sigBytes-=16}return p.create({ciphertext:t,salt:i})}},m=i.SerializableCipher=o.extend({cfg:o.extend({format:h}),encrypt:function(t,e,i,n){n=this.cfg.extend(n);var o=t.createEncryptor(i,n);return e=o.finalize(e),o=o.cfg,p.create({ciphertext:e,key:i,iv:o.iv,algorithm:t,mode:o.mode,padding:o.padding,blockSize:t.blockSize,formatter:n.format})},decrypt:function(t,e,i,n){return n=this.cfg.extend(n),e=this._parse(e,n.format),t.createDecryptor(i,n).finalize(e.ciphertext)},_parse:function(t,e){return"string"==typeof t?e.parse(t,this):t}}),e=(e.kdf={}).OpenSSL={execute:function(t,e,i,n){return n||(n=s.random(8)),t=l.create({keySize:e+i}).compute(t,n),i=s.create(t.words.slice(e),4*i),t.sigBytes=4*e,p.create({key:t,iv:i,salt:n})}},f=i.PasswordBasedCipher=m.extend({cfg:m.cfg.extend({kdf:e}),encrypt:function(t,e,i,n){return n=this.cfg.extend(n),i=n.kdf.execute(i,t.keySize,t.ivSize),n.iv=i.iv,t=m.encrypt.call(this,t,e,i.key,n),t.mixIn(i),t},decrypt:function(t,e,i,n){return n=this.cfg.extend(n),e=this._parse(e,n.format),i=n.kdf.execute(i,t.keySize,t.ivSize,e.salt),n.iv=i.iv,m.decrypt.call(this,t,e,i.key,n)}})}(),function(){for(var t=n,e=t.lib.BlockCipher,i=t.algo,o=[],s=[],r=[],a=[],l=[],c=[],h=[],d=[],u=[],p=[],m=[],f=0;256>f;f++)m[f]=128>f?f<<1:f<<1^283;for(var g=0,v=0,f=0;256>f;f++){var w=v^v<<1^v<<2^v<<3^v<<4,w=w>>>8^255&w^99;o[g]=w,s[w]=g;var _=m[g],b=m[_],y=m[b],k=257*m[w]^16843008*w;r[g]=k<<24|k>>>8,a[g]=k<<16|k>>>16,l[g]=k<<8|k>>>24,c[g]=k,k=16843009*y^65537*b^257*_^16843008*g,h[w]=k<<24|k>>>8,d[w]=k<<16|k>>>16,u[w]=k<<8|k>>>24,p[w]=k,g?(g=_^m[m[m[y^_]]],v^=m[m[v]]):g=v=1}var C=[0,1,2,4,8,16,32,64,128,27,54],i=i.AES=e.extend({_doReset:function(){for(var t=this._key,e=t.words,i=t.sigBytes/4,t=4*((this._nRounds=i+6)+1),n=this._keySchedule=[],s=0;t>s;s++)if(i>s)n[s]=e[s];else{var r=n[s-1];s%i?i>6&&4==s%i&&(r=o[r>>>24]<<24|o[r>>>16&255]<<16|o[r>>>8&255]<<8|o[255&r]):(r=r<<8|r>>>24,r=o[r>>>24]<<24|o[r>>>16&255]<<16|o[r>>>8&255]<<8|o[255&r],r^=C[s/i|0]<<24),n[s]=n[s-i]^r}for(e=this._invKeySchedule=[],i=0;t>i;i++)s=t-i,r=i%4?n[s]:n[s-4],e[i]=4>i||4>=s?r:h[o[r>>>24]]^d[o[r>>>16&255]]^u[o[r>>>8&255]]^p[o[255&r]]},encryptBlock:function(t,e){this._doCryptBlock(t,e,this._keySchedule,r,a,l,c,o)},decryptBlock:function(t,e){var i=t[e+1];t[e+1]=t[e+3],t[e+3]=i,this._doCryptBlock(t,e,this._invKeySchedule,h,d,u,p,s),i=t[e+1],t[e+1]=t[e+3],t[e+3]=i},_doCryptBlock:function(t,e,i,n,o,s,r,a){for(var l=this._nRounds,c=t[e]^i[0],h=t[e+1]^i[1],d=t[e+2]^i[2],u=t[e+3]^i[3],p=4,m=1;l>m;m++)var f=n[c>>>24]^o[h>>>16&255]^s[d>>>8&255]^r[255&u]^i[p++],g=n[h>>>24]^o[d>>>16&255]^s[u>>>8&255]^r[255&c]^i[p++],v=n[d>>>24]^o[u>>>16&255]^s[c>>>8&255]^r[255&h]^i[p++],u=n[u>>>24]^o[c>>>16&255]^s[h>>>8&255]^r[255&d]^i[p++],c=f,h=g,d=v;f=(a[c>>>24]<<24|a[h>>>16&255]<<16|a[d>>>8&255]<<8|a[255&u])^i[p++],g=(a[h>>>24]<<24|a[d>>>16&255]<<16|a[u>>>8&255]<<8|a[255&c])^i[p++],
v=(a[d>>>24]<<24|a[u>>>16&255]<<16|a[c>>>8&255]<<8|a[255&h])^i[p++],u=(a[u>>>24]<<24|a[c>>>16&255]<<16|a[h>>>8&255]<<8|a[255&d])^i[p++],t[e]=f,t[e+1]=g,t[e+2]=v,t[e+3]=u},keySize:8});t.AES=e._createHelper(i)}(),n.pad.Iso10126={pad:function(t,e){var i=4*e,i=i-t.sigBytes%i;t.concat(n.lib.WordArray.random(i-1)).concat(n.lib.WordArray.create([i<<24],1))},unpad:function(t){t.sigBytes-=255&t.words[t.sigBytes-1>>>2]}},i.exports=n}),define("bower_components/aes/main",["require","./aes"],function(t){var e=t("./aes"),i=e.enc.Utf8.parse("youzan.com.aesiv"),n=e.enc.Utf8.parse("youzan.com._key_");return{encrypt:function(t){return t=e.enc.Utf8.parse(t),e.AES.encrypt(t,n,{mode:e.mode.CBC,padding:e.pad.Iso10126,iv:i}).toString()}}}),define("text!bower_components/login/templates/init.html",[],function(){return'<form class="js-login-form popout-login" method="GET" action="">\n    <div class="header c-green center">\n        <h2>请填写您的手机号码</h2>\n    </div>\n    <fieldset class="wrapper-form font-size-14">\n        <div class="form-item">\n            <label for="phone">手机号</label>\n            <input id="phone" name="phone" type="tel" maxlength="11" autocomplete="off" placeholder="" value="<%= phone %>">\n        </div>\n        <div class="js-help-info font-size-12 error c-orange"></div>\n    </fieldset>\n    <div class="action-container">\n        <input type="submit" class="js-confirm btn btn-green btn-block font-size-14" value="确认手机号码" />\n    </div>\n</form>\n'}),define("text!bower_components/login/templates/login.html",[],function(){return'<form class="js-login-form popout-login" method="GET" action="">\n    <div class="header c-green center">\n        <h2>该号码注册过，请直接登录</h2>\n    </div>\n    <fieldset class="wrapper-form font-size-14">\n        <div class="form-item">\n            <label for="phone">手机号</label>\n            <input id="phone" name="phone" type="tel" maxlength="11" autocomplete="off" placeholder="请输入你的手机号" disabled="disabled" value="<%= phone %>">\n        </div>\n        <div class="form-item">\n            <label for="password">密码</label>\n            <input id="passsword" name="password"  type="password" autocomplete="off" placeholder="请输入登录密码">\n        </div>\n        <div class="js-help-info font-size-12 error c-orange"></div>\n    </fieldset>\n    <div class="action-container">\n        <button type="button" class="js-confirm btn btn-green btn-block font-size-14">\n            <%= showBindText ? \'登录并绑定\' : \'确认\' %>\n        </button>\n    </div>\n    <div class="bottom-tips font-size-12">\n        <span class="c-orange">如果您忘了密码，请</span><a href="javascript:;" class="js-change-pwd c-blue">点此找回密码</a>\n        <a href="javascript:;" class="js-change-phone c-blue pull-right">更换手机号</a>\n    </div>\n</form>\n'}),define("text!bower_components/login/templates/register.html",[],function(){return'<form class="js-login-form popout-login" method="GET" action="">\n    <div class="header c-green center">\n        <h2>注册有赞帐号</h2>\n    </div>\n    <fieldset class="wrapper-form font-size-14">\n        <div class="form-item">\n            <label for="phone">手机号</label>\n            <input id="phone" name="phone" type="tel" maxlength="11" autocomplete="off" placeholder="请输入你的手机号" disabled="disabled" value="<%= phone %>">\n        </div>\n        <div class="form-item js-image-verify hide">\n            <label for="verifycode">身份校验</label>\n            <input id="verifycode" name="verifycode" class="js-verify-code item-input"  type="tel" style="width:178px" maxlength="6" autocomplete="off" placeholder="输入右侧数字">\n            <img class="js-verify-image verify-image" src="">\n        </div>\n        <div class="form-item">\n            <label for="code">验证码</label>\n            <input id="code" name="code"  type="text" style="width:178px" maxlength="6" autocomplete="off" placeholder="输入短信验证码">\n            <button type="button" class="js-auth-code tag btn-auth-code tag-green font-size-12" data-text="获取验证码">\n                获取验证码\n            </button>\n        </div>\n        <div class="form-item">\n            <label for="password">密码</label>\n            <input id="passsword" name="password"  type="password" autocomplete="off" maxlength="20" placeholder="请输入8-20位数字和字母组合">\n        </div>\n        <div class="js-help-info font-size-12 error c-orange"></div>\n    </fieldset>\n    <div class="action-container">\n        <button type="button" class="js-confirm btn btn-green btn-block font-size-14">\n            <%= showBindText ? \'注册并绑定\' : \'确认\' %>\n        </button>\n    </div>\n    <div class="bottom-tips font-size-12">\n        <span class="c-orange">如果您忘了密码，请</span><a href="javascript:;" class="js-change-pwd c-blue">点此找回密码</a>\n        <a href="javascript:;" class="js-change-phone c-blue pull-right">更换手机号</a>\n    </div>\n</form>\n'}),define("text!bower_components/login/templates/change_pwd.html",[],function(){return'<form class="js-login-form popout-login" method="GET" action="">\n    <div class="header c-green center">\n        <h2><%if(isSetting){%>设定<%}else{%>找回<%}%>帐号密码</h2>\n    </div>\n    <fieldset class="wrapper-form font-size-14">\n        <div class="form-item">\n            <label for="phone">手机号</label>\n            <input id="phone" name="phone" type="tel" maxlength="11" autocomplete="off" placeholder="请输入你的手机号" disabled="disabled" value="<%= phone %>">\n        </div>\n        <div class="form-item js-image-verify hide">\n            <label for="verifycode">身份校验</label>\n            <input id="verifycode" name="verifycode" class="js-verify-code item-input"  type="tel" style="width:178px" maxlength="6" autocomplete="off" placeholder="输入右侧数字">\n            <img class="js-verify-image verify-image" src="">\n        </div>\n        <div class="form-item">\n            <label for="code">验证码</label>\n            <input id="code" name="code"  type="text" style="width:178px" maxlength="6" autocomplete="off" placeholder="输入短信验证码">\n            <button type="button" class="js-auth-code tag btn-auth-code font-size-12 tag-green" data-text="获取验证码">\n                获取验证码\n            </button>\n        </div>\n        <div class="form-item">\n            <label for="password">密码</label>\n            <input id="passsword" name="password"  type="password" autocomplete="off" placeholder="设置新的8-20位数字和字母组合密码">\n        </div>\n        <div class="js-help-info font-size-12 error c-orange"></div>\n    </fieldset>\n    <div class="action-container">\n        <button type="button" class="js-confirm btn btn-green btn-block font-size-14">确定</button>\n    </div>\n    <div class="bottom-tips pull-right">\n        <a href="javascript:;" class="js-login inline-item c-blue">已有帐号登录</a>\n        <a href="javascript:;" class="js-register inline-item c-blue">注册新帐号</a>\n    </div>\n</form>\n'}),define("zenjs/util/valid",[],function(){window.zenjs=window.zenjs||{};var t={validMobile:function(t){return t=""+t,/^((\+86)|(86))?(1)\d{10}$/.test(t)},validPhone:function(t){return t=""+t,/^0[0-9\-]{10,13}$/.test(t)},validNumber:function(t){return/^\d+$/.test(t)},validEmail:function(t){return/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(t)},validPostalCode:function(t){return t=""+t,/^\d{6}$/.test(t)}};return window.zenjs.Valid=t,t}),window.Zepto&&function(t){t.fn.serializeArray=function(){var e,i,n=[],o=function(t){return t.forEach?t.forEach(o):void n.push({name:e,value:t})};return this[0]&&t.each(this[0].elements,function(n,s){i=s.type,e=s.name,e&&"fieldset"!=s.nodeName.toLowerCase()&&!s.disabled&&"submit"!=i&&"reset"!=i&&"button"!=i&&"file"!=i&&("radio"!=i&&"checkbox"!=i||s.checked)&&o(t(s).val())}),n},t.fn.serialize=function(){var t=[];return this.serializeArray().forEach(function(e){t.push(encodeURIComponent(e.name)+"="+encodeURIComponent(e.value))}),t.join("&")},t.fn.submit=function(e){if(0 in arguments)this.bind("submit",e);else if(this.length){var i=t.Event("submit");this.eq(0).trigger(i),i.isDefaultPrevented()||this.get(0).submit()}return this}}(Zepto),define("vendor/zepto/form",function(){}),define("zenjs/util/form",["require","exports","module","vendor/zepto/form","jquery"],function(t,e,i){t("vendor/zepto/form");var n=t("jquery");window.zenjs=window.zenjs||{};var o={getFormData:function(t){var e=t.serializeArray(),i={};return n.map(e,function(t){i[t.name]=t.value}),i}};window.zenjs.Form=o,i.exports=o}),define("zenjs/sms_fetch/main",["require","exports","module","bower_components/ajax/ajax","jquery"],function(t,e,i){function n(){this.loadingLock=!1,this.isUsed=void 0}function o(t){t=t||{},this.$el=s(t.el||t.$el||"<div></div>"),this.el=this.$el[0],this.$=function(t){return this.$el.find(t)},this.initialize&&this.initialize(t)}t("bower_components/ajax/ajax");var s=t("jquery"),r=function(){};n.prototype={fetch:function(){if(this.isUsed!==!1){var t=this;this.loadingLock=!0,s._ajax({url:window._global.url.www.replace(/^https?:\/\//,"//")+"/common/token/token.jsonp",type:"get",dataType:"jsonp"}).done(function(e){0==e.code?(t.token=e.data,t.loadingLock=!1,t.isUsed=!1):motify.log(e.msg)}).fail(function(){motify.log("token 获取失败")})}},get:function(){return this.isUsed=!0,this.token}};var a=new n;s.extend(o.prototype,{initialize:function(t){this.duration=t.time||60,this.step=t.step||1100,this.codeVerifyClass=t.codeVerifyClass||"js-verify-code",this.verifyType="smsFetch";var e=window._global.url.www.replace(/^https?:\/\//,"//");this.smsFetchUrl=e+"/common/sms/captcha.jsonp",this.imgUrl=e+"/common/sms/imgcaptcha",this.imgVerifyUrl=e+"/common/sms/imgcaptcha.jsonp",this.biz=t.biz||"kdt_account_captcha",this.onTimeChange=t.onTimeChange||r,this.onTimeEnd=t.onTimeEnd||r,this.onTimerStart=t.onTimerStart||r,this.onTimerClose=t.onTimerClose||r,this.onVerifyPictureShow=t.onVerifyPictureShow||r,this.onGetCodeError=t.onGetCodeError||r,this.onVerifyPictureSuccess=t.onVerifyPictureSuccess||r,this.onVerifyPictureError=t.onVerifyPictureError||r,this.platform=t.platform||"",this.subFrom=t.subFrom||"",a.fetch()},setMobile:function(t){t&&(this.mobile=t)},getImageCode:function(){return s.trim(this.$("."+this.codeVerifyClass).val())},getSms:function(t){var e=this;if(a.loadingLock)return void motify.log("数据加载中，稍后再试");if(t=t||{},t.mobile&&(this.mobile=t.mobile),!this.mobile)return!1;var i={smsFetch:e.onSmsFetchHandler,image:e.onImageHandler};return e.startTimer.call(e),(i[e.verifyType]||r).call(e),this},startTimer:function(){this.onTimerStart(),this.btnCountdown(this.duration)},stopTimer:function(){clearTimeout(this.timer),this.onTimerClose()},btnCountdown:function(t){var e=this;this.onTimeChange({second:t}),--t>=0?this.timer=setTimeout(function(){e.btnCountdown(t)},this.step):(this.onTimeEnd(),this.timer="")},onVerifyImageShow:function(t){this.$(".js-image-verify").removeClass("hide"),this.$(".js-verify-image").attr("src",t)},onVerifyImageHide:function(){this.$(".js-image-verify").addClass("hide")},onSmsFetchHandler:function(){var t=1;return function(){var e=this,i={verifyTimes:t,mobile:this.mobile,biz:this.biz,token:a.get()};this.platform&&(i.platform=this.platform),this.subFrom&&(i.sub_from=this.subFrom),s._ajax({url:this.smsFetchUrl,dataType:"jsonp",data:i,success:function(i){return 0==i.code?void t++:(e.stopTimer.call(e),e.onGetCodeError.call(e),void(10111===i.code?(e.verifyType="image",e.onVerifyImageShow(e.imgUrl),e.onVerifyPictureShow()):(t++,motify.log(i.msg))))},error:function(i,n,o){t++,e.stopTimer.call(e),e.onGetCodeError.call(e),motify.log("获取验证码失败，请稍后再试")},complete:function(t,e){}}).always(function(){a.fetch()})}}(),onImageHandler:function(){var t=this,e=this.mobile;s._ajax({url:this.imgVerifyUrl,dataType:"jsonp",data:{mobile:e,captcha_code:this.getImageCode()},success:function(i){return 0===i.code?(t.verifyType="smsFetch",t.mobile=e,t.onVerifyImageHide(),t.onVerifyPictureSuccess(),void t.onSmsFetchHandler()):(t.stopTimer.call(t),t.onVerifyPictureError.call(t),void(10100===i.code?(motify.log(i.msg),t.$el.find(".js-verify-image").attr("src",t.imgUrl)):motify.log(i.msg)))},error:function(e,i,n){t.stopTimer.call(t),t.onVerifyPictureError.call(t),motify.log("图形验证失败，重试一下吧~"),t.$el.find(".js-verify-image").attr("src",t.imgUrl)},complete:function(t,e){}})}}),i.exports=o}),define("zenjs/util/url_helper",[],function(){var t={site:function(t,e){var i=window._global.env,n=window._global.url;"static"===e&&"online"===i&&(e="cdn_static");var o=t;return e=e?n[e]||"":"",-1==t.search(/^http[s]?\:\/\//)&&("/"!==t[0]&&(t="/"+t),o=e+t),o},getCdnImageUrl:function(t,e){if(!t)return window._global.url.cdn_static+"/image/wap/no_pic.png";if(e=t.match(/.+\!\d+x\d+.+/)?"":e&&e.length>0?e:"!100x100.jpg",t.match(/^(https?:)?\/\//i)){for(var i=[/^(https?:)?\/\/imgqn.koudaitong.com/,/^(https?:)?\/\/kdt-img.koudaitong.com/,/^(https?:)?\/\/img.yzcdn.cn/,/^(https?:)?\/\/dn-kdt-img.qbox.me/],n=0;n<i.length;n++)t=t.replace(i[n],window._global.url.imgqn);return t+e}return window._global.url.imgqn+"/"+t+e}};return t}),define("bower_components/login/main",["require","bower_components/ajax/ajax","jquery","backbone","bower_components/aes/main","text!./templates/init.html","text!./templates/login.html","text!./templates/register.html","text!./templates/change_pwd.html","zenjs/util/valid","zenjs/util/form","zenjs/sms_fetch/main","zenjs/util/url_helper","zenjs/util/ua"],function(t){t("bower_components/ajax/ajax");var e=t("jquery"),i=t("backbone"),n=t("bower_components/aes/main"),o=t("text!./templates/init.html"),s=t("text!./templates/login.html"),r=t("text!./templates/register.html"),a=t("text!./templates/change_pwd.html"),l=t("zenjs/util/valid"),c=t("zenjs/util/form"),h=t("zenjs/sms_fetch/main"),d=t("zenjs/util/url_helper"),u=t("zenjs/util/ua"),p=["youzanmars"],m=i.View.extend({events:{"click .js-confirm":"onConfirmClicked","click .js-change-phone":"onChangePhoneClicked","click .js-change-pwd":"onChangePwdClicked","click .js-login":"onLoginClicked","click .js-register":"onRegisterClicked","click .js-auth-code":"onAuthcodeClicked","submit .js-login-form":"onConfirmClicked"},initialize:function(t){t=t||{};var i=u.getPlatform();if(p.indexOf(i)>-1)return void(window.location.href=d.site("/buyer/kdtunion?redirect_uri="+encodeURIComponent(window.location.href),"wap"));var n=this,l=_global.url;this.tpl_map={init:_.template(t.initTpl||o),login:_.template(t.loginTpl||s),register:_.template(t.registerTpl||r),changePwd:_.template(t.changePwdTpl||a)},this.valid_map={checkPhone:_(this.checkPhone).bind(this),checkPwd:_(this.checkPwd).bind(this),checkCode:_(this.checkCode).bind(this)},this.renderOpt=t.renderOpt||{type:"init",phone:""},this.renderOpt.showBindText=u.isWeixin()||u.isQQ(),this.urlMap={login:t.loginUrl||l.uic+"/buyer/auth/authlogin.json",register:t.registerUrl||l.uic+"/buyer/auth/authRegister.json",changePwd:t.changePwdUrl||l.uic+"/buyer/auth/changePassword.json",confirm:t.confirmUrl||l.uic+"/buyer/auth/authConfirm.json"},this.source=t.source||2,this.ajaxType=t.ajaxType||"POST",this.afterLogin=t.afterLogin||function(){};var c,m;u.isMobile()?(c="app",m="wsc",u.isWxd()?m="wxd":u.isWsc()?m="wsc":u.isPf()?m="pf":c="wap"):c="pc",this.sms=new h({el:this.$el,onTimeChange:function(t){var i=t.second;e(n.nAuthCode).text("等待 "+i+"秒")},onTimeEnd:function(){n.nAuthCode.text("再次获取"),n.nAuthCode.prop("disabled",!1),n.nAuthCode.removeClass("disabled"),n.nCodeInput.attr("placeholder","没有收到验证码？")},onTimerStart:function(){n.nAuthCode.prop("disabled",!0),n.nAuthCode.addClass("disabled")},onVerifyPictureError:function(){n.nAuthCode.removeAttr("disabled"),n.nAuthCode.removeClass("disabled"),n.nAuthCode.text("再次获取")},onGetCodeError:function(){n.nAuthCode.removeAttr("disabled"),n.nAuthCode.removeClass("disabled"),n.nAuthCode.text("再次获取")},onVerifyPictureShow:function(){n.nHelpInfo.html("操作过于频繁，请先输入图像验证码再获取")},onVerifyPictureSuccess:function(){n.nHelpInfo.html("")},platform:c,subFrom:m})},render:function(){return this.appLogined?this:(this.$el.html(this.tpl_map[this.renderOpt.type](this.renderOpt)),this.nForm=this.$(".js-login-form"),this.nHelpInfo=this.$(".js-help-info"),this.nPhone=this.$('input[name="phone"]'),this.nPwd=this.$('input[name="password"]'),this.nCodeInput=this.$('input[name="authcode"]'),this.nAuthCode=this.$(".js-auth-code"),this)},show:function(t,e){"changePwd"==t?this.sms.biz="reset_account_passwd":this.sms.biz="kdt_account_captcha",_.extend(this.renderOpt,{type:t},e||{isSetting:!1}),this.render(this.renderOpt),this.$el.show(this.animationTime)},onConfirmClicked:function(t){t.preventDefault();var i=this,o=e(t.target),s=c.getFormData(i.nForm);if(s=_.extend(i.renderOpt,s),!i.validate(s))return!1;s.source=this.source,s.password&&(s.password=n.encrypt(s.password));var r=o.html();if("init"===i.renderOpt.type)i.renderOpt.phone=s.phone,e._ajax({url:this.urlMap.confirm,type:"POST",dataType:"json",timeout:15e3,data:s,xhrFields:{withCredentials:!0},beforeSend:function(){o.html("确认中..."),o.prop("disabled",!0)},success:function(t){switch(+t.code){case 0:i.show("login");break;case 135000003:i.show("register");break;default:i.nHelpInfo.html(t.msg)}},error:function(){i.nHelpInfo.html("出错啦，请重试")},complete:function(){o.html(r),o.prop("disabled",!1)}});else{var a=i.renderOpt.type;e._ajax({url:this.urlMap[a],type:this.ajaxType,dataType:"json",timeout:15e3,data:s,xhrFields:{withCredentials:!0},beforeSend:function(){o.html("确认中..."),o.prop("disabled",!0)},success:function(t){0===t.code?i.afterLogin(t,{type:a}):i.nHelpInfo.html(t.msg)},error:function(){i.nHelpInfo.html("出错啦，请重试")},complete:function(){o.html(r),o.prop("disabled",!1)}})}},onAuthcodeClicked:function(t){t.preventDefault();var e=this,i=c.getFormData(e.nForm);i=_.extend(e.renderOpt,i);var n=i.phone;this.sms.setMobile(n),this.sms.getSms()},onChangePhoneClicked:function(t){t.preventDefault(),this.show("init")},onChangePwdClicked:function(t){t.preventDefault(),this.sms.stopTimer(),this.show("changePwd")},onLoginClicked:function(t){t.preventDefault(),this.show("init")},onRegisterClicked:function(t){t.preventDefault(),this.show("init")},validate:function(){var t={init:["checkPhone"],login:["checkPwd"],register:["checkCode","checkPwd"],changePwd:["checkCode","checkPwd"]};return function(e){return _.every(t[e.type],_(function(t){return this.valid_map[t](e)}).bind(this))}}(),checkPhone:function(t){return""===t.phone?(this.nPhone.focus(),this.nHelpInfo.html("请填写您的手机号码"),!1):l.validMobile(t.phone)?!0:(this.nPhone.focus(),this.nHelpInfo.html("请填写11位手机号码"),!1)},checkPwd:function(t){function e(t){var e=/[a-zA-Z]/g,i=/[0-9]/g,n=0,o=e.test(t),s=i.test(t);return o&&s&&(n=1),n}if(""===t.password)return this.nPwd.focus(),this.nHelpInfo.html("请输入您的密码"),!1;if("login"!==this.renderOpt.type&&t.password.length<8)return this.nPwd.focus(),this.nHelpInfo.html("亲，密码最短为8位"),!1;if("login"!==this.renderOpt.type&&t.password.length>20)return this.nPwd.focus(),this.nHelpInfo.html("亲，密码最长为20位"),!1;if("login"!==this.renderOpt.type){var i=e(t.password);if(!i)return this.nPwd.focus(),this.nHelpInfo.html("亲，密码为8-20位数字和字母组合"),!1}return!0},checkCode:function(t){return l.validPostalCode(t.code)?!0:(this.nCodeInput.focus(),this.nHelpInfo.html("请填写6位短信验证码"),!1)}});return m}),function(t){var e;t.localStorage;try{var i=new Date;try{localStorage.setItem(i,i)}catch(n){if(22===n.code)throw"localstorage define error"}var o=localStorage.getItem(i)==i;if(localStorage.removeItem(i),!o)throw"localstorage define error";if("FUNCTION"!=(typeof localStorage.clear).toUpperCase())throw"localstorage define error";e=localStorage}catch(n){var s=function(){return null};e={getItem:s,setItem:s,removeItem:s,clear:s}}"function"==typeof define&&define.amd&&define("zenjs/util/local_storage",[],function(){return e}),t.YZLocalStorage=e}(window),define("wap/components/new_cart/main",["require","./shop_list/main","./shop_list/models/shop","bower_components/zenlist/list","./invalid_goods_list/main","text!wap/components/new_cart/templates/empty.html","text!wap/components/new_cart/templates/emptyListTpl.html","text!wap/components/new_cart/templates/login_tip.html","text!wap/components/new_cart/templates/close_warn.html","bower_components/youzanjsbridge/api","bower_components/pop/popout_box","bower_components/login/main","backbone","underscore","jquery","zenjs/util/args","zenjs/util/local_storage"],function(t){var e=t("./shop_list/main"),i=t("./shop_list/models/shop"),n=t("bower_components/zenlist/list"),o=t("./invalid_goods_list/main"),s=t("text!wap/components/new_cart/templates/empty.html"),r=t("text!wap/components/new_cart/templates/emptyListTpl.html"),a=t("text!wap/components/new_cart/templates/login_tip.html"),l=t("text!wap/components/new_cart/templates/close_warn.html"),c=t("bower_components/youzanjsbridge/api"),h=t("bower_components/pop/popout_box"),d=t("bower_components/login/main"),u=t("backbone"),p=t("underscore"),m=t("jquery"),f=window.motify,g=t("zenjs/util/args"),v=t("zenjs/util/local_storage"),w=window._global;return u.View.extend({initialize:function(t){this.url=t.url,this.deleteBatchUrl=t.deleteBatchUrl,this.deleteBatchIdName=t.deleteBatchIdName,this.bottomView=t.bottomView,this.allGoodsList=[],this.allInvalidGoods=[],this.isAppCart=!!t.isAppCart,this.forbidLogin=t.forbidLogin,this.shopListCollection=null,this.isFromConfrimMerge=t.isFromConfrimMerge},render:function(){return m._ajax({url:this.url,type:"GET",dataType:"json",timeout:1e4,success:p(function(t){this.$el.html("");var s=t.data,r=[],a=[];return s&&0!=s.length?(this.forbidLogin||"youzanwxd"===w.platform||this.renderLoginContainer(),this.$el.append('<div class="js-shop-list shop-list"></div>'),this.$el.append('<div class="js-invalid-goods shop-list"></div>'),p.each(s,function(t){t.goods_list&&t.goods_list.length>0&&r.push(t),a=a.concat(t.unavailable_goods_list)}),this.shopListCollection=new i(r),this.shoplistView=new n({el:this.$el.find(".js-shop-list"),collection:this.shopListCollection,itemView:e,itemOptions:{url:this.url,isAppCart:this.isAppCart,isFromConfrimMerge:this.isFromConfrimMerge,deleteBatchUrl:this.deleteBatchUrl,deleteBatchIdName:this.deleteBatchIdName,bottomView:this.bottomView,onEditingChange:p(this.onEditingChange).bind(this),onSwipeEnd:p(this.onSwipeEnd).bind(this)}}),r.length>0&&this.shoplistView.render(),a.length>0&&(this.invalidListView=new o({el:m(".js-invalid-goods"),url:this.url,items:a,isAppCart:this.isAppCart,collectionOptions:{modelUrlRoot:this.url},deleteBatchUrl:this.deleteBatchUrl,onSwipeEnd:p(this.onSwipeEnd).bind(this)}).render(),this.allInvalidGoods=this.invalidListView.listView.collection,this.listenTo(this.allInvalidGoods,"remove",this.onGoodsRemoved,this)),this.trigger("on:fetch:data",s),this.allGoodsList=this.bottomView.goodsList,this.changeKdtId(),this.checkEmpty(),this.listenTo(this.allGoodsList,"remove",this.onGoodsRemoved,this),void this.listenTo(this.shopListCollection,"remove",this.onShopRemoved,this)):void this.onGoodsRemoved()}).bind(this),error:function(t,e,i){f.log("数据加载失败")}}),this},onSwipeEnd:function(){"youzanmars"!==w.platform||"android"!==w.mobile_system||this.isFired||(this.isFired=!0,m(m(".j-edit-list")[0]).css("display","none").css("display","block"))},renderLoginContainer:function(){var t=this,e=(new Date).getTime(),i=v.getItem("close_login_tip_time")||0,n=(w.need_ajax_login||w.wap_cart_need_ajax_login)&&w.buyer_id<=0;n&&e-i>864e5&&(this.$el.append(p.template(a)({isAppCart:t.isAppCart})),this.loginTipContainer=this.$el.find(".js-login-tip"),this.$(".js-login-btn").on("click",p(this.onLoginBtnClick).bind(this)),this.$(".js-close-login").on("click",p(this.onCloseLoginClick).bind(this)))},events:{"click .js-go-home":"onGoHomeClick"},onLoginBtnClick:function(){var t=this,e=new h({contentViewClass:d,contentViewOptions:{afterLogin:function(i){e.hide(),t.bottomView.need_ajax_login=!1,t.loginTipContainer.hide(),window.location.reload()}}});e.render().show()},onCloseLoginClick:function(){var t=this,e=new h({html:p.template(l),transparent:".8",className:"no-padding",width:"240px",onOKClicked:function(){e.hide(),t.loginTipContainer.hide(),v.setItem("close_login_tip_time",(new Date).getTime())}}).render().show()},onEditingChange:function(t){t.editing?this.shoplistView.items.forEach(function(e){e!=t.view&&e.hideEditBtn()}):(this.bottomView.setEditing(!1),this.bottomView.goodsList=this.allGoodsList,this.bottomView.update(),this.shoplistView.items.forEach(function(t){t.showEditBtn()}))},onGoodsRemoved:function(){this.checkEmpty()},checkEmpty:function(){0==this.allGoodsList.length&&0===this.allInvalidGoods.length&&this.doShowEmpty(),this.bottomView.update()},doShowEmpty:function(){this.$el.html(this.getEmptyListHtml()),this.bottomView.$el.hide(),m("body").removeClass("body-fixed-bottom")},getEmptyListHtml:function(){var t=p.template(r),e=p.template(s),i="";return i=w.kdt_id>0&&"yzapp"!=g.get("f_platform")?w.url.wap+"/showcase/homepage?kdt_id="+w.kdt_id:"https://maijia.koudaitong.com/",t({text:"快给我挑点宝贝",html:e({homepage:i}),style:"padding-top:60px;",className:""})},onGoHomeClick:function(t){this.isAppCart&&(t.preventDefault(),t.stopPropagation(),c.doAction({action:"goHome"}))},onShopRemoved:function(){0==this.allGoodsList.length&&0===this.allInvalidGoods.length?this.doShowEmpty():(this.changeKdtId(),this.onEditingChange({editing:!1}))},changeKdtId:function(){1==this.shopListCollection.models.length&&(this.allGoodsList.kdt_id=this.shopListCollection.models[0].get("kdt_id"))}})}),define("text!wap/components/new_cart/templates/conflictTip.html",[],function(){return'<div class="conflict-pop-box">\n	<h3 class="font-size-18 text-center">\n		下单提醒\n	</h3>\n	<p class="c-gray-darker font-size-14">含有仅支持货到付款的商品，无法与在线支付的商品同时购买，请修改购物车后，重新下单。</p>\n	<div class="action-container">\n		<a href="javascript:void(0);" class="btn btn-block btn-green font-size-14 js-ok">我知道了</a>\n	</div>\n</div>'}),define("wap/components/new_cart/bottom",["require","zenjs/util/args","bower_components/pop/popout_box","text!wap/components/new_cart/templates/conflictTip.html"],function(t){var e=function(){},i=t("zenjs/util/args"),n=t("bower_components/pop/popout_box"),o=t("text!wap/components/new_cart/templates/conflictTip.html");return Backbone.View.extend({events:{"click .js-go-pay":"onGoPayClick","click .select-all":"onSelectAllClick","click .j-delete-goods":"_onDeleteGoodsClick","click .js-cancel-delete":"_onCancelDeleteClicked"},initialize:function(t){this.onDeleteClicked=t.onDeleteClicked||e,this.onCancelDeleteClicked=t.onCancelDeleteClicked||e,this.doBeforeGoPay=t.doBeforeGoPay||e,this.nTotalPrice=this.$(".js-total-price"),this.nGoPay=this.$(".js-go-pay"),this.goodsList=t.goodsList,this.goPayUrl=t.goPayUrl,this.goPayText=t.goPayText||this.nGoPay.text()||"结算",this.nTotalPriceContainer=this.$(".total-price"),this.nSelectAll=this.$(".select-all span"),this.nSelectAllContainer=this.$(".select-all"),this.nDeleteGoods=this.$(".j-delete-goods"),this.nBottom=this.$(".bottom"),this.nCancelDeleteBtn=this.$(".js-cancel-delete"),this.isMultiShop=!1,this.kdtIdArr=[]},onGoPayClick:function(){if(!this.ajaxing){window.Logger&&window.Logger.log({fm:"click",title:"cart_pay"}),this.doBeforeGoPay&&this.doBeforeGoPay();var t=this.goodsList.getGoodsListJson(this.isMultiShop);if(t.errorMsg&&t.errorMsg.length>0)return void motify.log(t.errorMsg);if(!t.json)return void motify.log("请先勾选商品");var e=this;if(!t.json.isConflict||this.poping)this.doSubmit(t.json);else{e.poping=!0;var i=new n({html:_.template(o),transparent:".8",className:"no-padding",width:"280px",onOKClicked:function(){i.hide(),e.poping=!1}}).render().show()}}},doWait:function(t){t>0?(this.nGoPay.attr("disabled",!0),this.nGoPay.text("请等待 "+t+" 秒"),setTimeout(_(this.doWait).bind(this,t-1),1e3)):(this.nGoPay.removeAttr("disabled"),this.update())},doSubmit:function(t){var e=this,n=i.get("from");n&&n.length>0&&(this.goPayUrl=i.add(this.goPayUrl,{from:n})),$._ajax({url:this.goPayUrl,type:"POST",dataType:"json",timeout:1e4,data:JSON.stringify(t),beforeSend:function(){e.ajaxing=!0,e.nGoPay.html("提交中..")},success:function(t){var i=t.code;if(0===i&&t.data)return void(location.href=t.data.trade_confirm_url);if(0!==i){if(11100==i&&t.data&&_.isArray(t.data))_.each(t.data,function(t){var i=e.goodsList.get(parseInt(t.id,10));i&&i.set({error_msg:t.error_msg,error_code:t.error_code,lastest_price:t.lastest_price,lastest_stock:t.lastest_stock},{silent:!1,wait:!1})});else{if(12500==i)return void e.doWait(+t.data.wait);if(10500==i)return e.goodsList.reset(),void(t.msg&&motify.log(t.msg));t.msg&&motify.log(t.msg)}e.nGoPay.text(e.goPayText)}e.update()},error:function(t,i,n){e.nGoPay.text(e.goPayText)},complete:function(t,i){e.ajaxing=!1}})},onSelectAllClick:function(t){var e=this.getCheckBoxClassName(),i=this.nSelectAll.hasClass(e);this.goodsList.updateAllCheck(!i,e),this.update()},_onDeleteGoodsClick:function(){var t=this;this.nDeleteGoods.hasClass("btn-disabled")||(this.nDeleteGoods.addClass("btn-disabled"),window.setTimeout(function(){t.nDeleteGoods.removeClass("btn-disabled")},100),this.onDeleteClicked(),this.trigger("delete:click"),this.update())},_onCancelDeleteClicked:function(){this.onCancelDeleteClicked(),this.trigger("cancelDelete:click")},updateSelectAll:function(t,e){this.nSelectAll.removeClass("delete").removeClass("checked"),this.nSelectAllContainer.removeClass("delete").removeClass("checked"),0!==this.goodsList.length&&(t?(this.nSelectAllContainer.addClass(e),this.nSelectAll.addClass(e)):(this.nSelectAllContainer.removeClass(e),this.nSelectAll.removeClass(e)))},updateTotalPrice:function(t){this.editing?this.nTotalPriceContainer.hide():(this.nTotalPrice.html((t/100).toFixed(2)),t>0?this.nTotalPriceContainer.removeClass("c-gray-dark"):this.nTotalPriceContainer.addClass("c-gray-dark"),this.nTotalPriceContainer.show())},updatePayDeleteBtn:function(t){this.editing?(this.updateButtonEnable(this.nDeleteGoods,t.flagged>0),t.flagged>0?this.nCancelDeleteBtn.removeClass("hide"):this.nCancelDeleteBtn.addClass("hide"),this.nGoPay.addClass("hide"),this.nDeleteGoods.removeClass("hide")):(this.updateButtonEnable(this.nGoPay,t.flagged>0),this.nDeleteGoods.addClass("hide"),this.nCancelDeleteBtn.addClass("hide"),this.nGoPay.html("结算"+(t.flagged>0?"("+t.flagged+")":"")),this.nGoPay.removeClass("hide"))},update:function(t){var e,i,s=this,t=t||{},r=this.getCheckBoxClassName(),a=this.goodsList.getBrief(r);if(a.isConflict&&"remove"!==t.action&&(e=t.list&&t.list.models,i=e&&e[0].shop_kdt_id,s.kdtIdArr.push(i),!this.poping)){s.poping=!0;var l=new n({html:_.template(o),transparent:".8",className:"no-padding",width:"280px",onOKClicked:function(){s.goodsList&&s.goodsList.forEach(function(t){t.get("checked")&&-1!==s.kdtIdArr.indexOf(t.shop_kdt_id)&&t.set("checked",!1)}),l.hide(),s.poping=!1,s.kdtIdArr=[]}}).render().show()}a.flagged<=0?this.nBottom.addClass("disable"):this.nBottom.removeClass("disable"),this.editing?this.nBottom.addClass("editing"):this.nBottom.removeClass("editing"),this.updateSelectAll(a.flagged==a.total,r),this.updateTotalPrice(a.totalPrice),this.updatePayDeleteBtn(a)},getCheckBoxClassName:function(){return this.editing?"delete":"checked"},updateButtonEnable:function(t,e){e?t.removeAttr("disabled"):t.attr("disabled","true")},setEditing:function(t){this.editing=t}})}),define("wap/trade/cart/views/bottom",["zenjs/util/args","wap/components/new_cart/bottom","vendor/zepto/form","bower_components/login/main","bower_components/pop/popout_box","bower_components/youzanjsbridge/api","wap/components/new_cart/goods_list/collections/goods_list","bower_components/wap_common/base/make_url_log"],function(t,e,i,n,o,s,r,a){
return e.extend({initialize:function(t){e.prototype.initialize.apply(this,[t]),this.goodsList=new r([],{});var i=window._global;this.need_ajax_login=i.need_ajax_login,this.isAppCart=!!t.isAppCart},goPay:function(e){var i=window._global,n=this,o={activity_alias:[],activity_id:"",activity_type:"",order_from:"cart"},r=e.cart;r.length&&r.forEach(function(t){var e=t;t.kdt_id&&(e=t.sku_list),e.length?e.forEach(function(t){o.activity_alias.push({goods_id:t.goods_id,sku_id:t.sku_id,activity_alias:t.activity_alias})}):o.activity_alias.push({goods_id:e.goods_id,sku_id:e.sku_id,activity_alias:e.activity_alias})}),e.isMultiShopChecked?o.kdt_id=i.kdt_id:o.kdt_id=e.kdt_id,i.offline_id&&(o.store_id=i.offline_id);var l=t.get("from"),c=t.get("kdtfrom");(l&&l.length>0||c&&c.length>0)&&(n.goPayUrl=t.add(n.goPayUrl,{from:l,kdtfrom:c})),l&&l.length>0&&(o.from=l);var h={common:JSON.stringify(o)},d=e.isMultiShopChecked?"goods_list":"goodsList";h[d]=JSON.stringify((e||{}).cart),h.isMultiShopChecked=e.isMultiShopChecked?1:0,$._ajax({url:"/v2/trade/common/cache.json",type:"POST",dataType:"json",data:h,beforeSend:function(){n.ajaxing=!0},success:function(i){var o=i.code,r=i.data;if(0!==o)return void motify.log(i.msg);var l=window._global.url.trade+r.url;e.isMultiShopChecked||(l=t.add(l,{showwxpaytitle:1,kdt_id:e.kdt_id})),l=t.add(l,{book_key:r.key}),l=a(l),n.isAppCart?s.gotoWebview({url:l,page:"web"}):location.href=l},complete:function(){n.ajaxing=!1}})},doSubmit:function(t){var e=this;if(!this.ajaxing){if(this.need_ajax_login&&_global.buyer_id<=0){var i=new o({contentViewClass:n,contentViewOptions:{afterLogin:function(n){i.hide(),e.need_ajax_login=!1,e.goPay(t)}}});return void i.render().show()}e.goPay(t)}}})}),require(["wap/components/new_cart/main","wap/trade/cart/views/bottom","zenjs/util/args"],function(t,e,i){var n=["youzanmars"],o=window._global.platform,s=n.indexOf(o)>-1,r="confirm_merge"===i.get("from",location.href),a="/v2/trade/cart/goods.json",l=i.get("source"),c=new e({el:$(".js-bottom-opts"),goPayUrl:"/v2/trade/cart/cart.json",isAppCart:s});("youzanmars"===o||"yzapp"===l)&&(a=i.add(a,{type:"all"}));var h=new t({el:"#cart-container",url:a,bottomView:c,deleteBatchUrl:"/v2/trade/cart/deleteBatchList.json?kdt_id="+window._global.kdt_id,deleteBatchIdName:"sku_id",isAppCart:s,forbidLogin:window._global.is_third_app,isFromConfrimMerge:r}).render();h.on("on:fetch:data",function(t){t.length>0?c.$el.removeClass("hide"):c.update(),c.isMultiShop=t.length>1})}),define("main",function(){});